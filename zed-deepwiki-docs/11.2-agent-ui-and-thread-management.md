<!-- Source: https://deepwiki.com/zed-industries/zed/11.2-agent-ui-and-thread-management -->

# 11.2 Agent Ui And Thread Management

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Agent UI and Thread Management

Relevant source files

  * [crates/acp_thread/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/Cargo.toml>)
  * [crates/acp_thread/src/acp_thread.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs>)
  * [crates/acp_thread/src/connection.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/connection.rs>)
  * [crates/acp_thread/src/mention.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs>)
  * [crates/agent_servers/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/Cargo.toml>)
  * [crates/agent_servers/src/acp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/acp.rs>)
  * [crates/agent_servers/src/agent_servers.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/agent_servers.rs>)
  * [crates/agent_servers/src/claude.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/claude.rs>)
  * [crates/agent_servers/src/custom.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/custom.rs>)
  * [crates/agent_servers/src/e2e_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/e2e_tests.rs>)
  * [crates/agent_servers/src/gemini.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/gemini.rs>)
  * [crates/agent_ui/src/acp/entry_view_state.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs>)
  * [crates/agent_ui/src/acp/message_editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs>)
  * [crates/agent_ui/src/acp/thread_view.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs>)
  * [crates/agent_ui/src/agent_panel.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs>)


## Purpose and Scope

This page documents the user interface layer and thread management system for AI agents in Zed. It covers the primary UI components (`AgentPanel`, `AcpThreadView`, `MessageEditor`, `EntryViewState`), thread lifecycle management, state transitions, and how threads are displayed and interacted with through the UI.

For details on the underlying Agent Communication Protocol (ACP), see page 11.1. For agent connection abstractions and implementations, see page 11.3. For tool system details, see page 11.4.

* * *

## UI Component Architecture

The agent UI consists of a hierarchical component structure with clear separation of concerns:

**Title: Agent UI Component Hierarchy**


**Sources** : [crates/agent_ui/src/agent_panel.rs210-224](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L210-L224>) [crates/agent_ui/src/acp/thread_view.rs264-301](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L264-L301>) [crates/agent_ui/src/acp/message_editor.rs39-49](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L39-L49>) [crates/agent_ui/src/acp/entry_view_state.rs23-54](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L23-L54>) [crates/agent_ui/src/acp/entry_view_state.rs260-327](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L260-L327>)

* * *

## AgentPanel: The Container

`AgentPanel` ([crates/agent_ui/src/agent_panel.rs418-445](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L418-L445>)) is the top-level container that manages different views and provides the docking panel interface:


### ActiveView Enum

The panel can display one of several views ([crates/agent_ui/src/agent_panel.rs211-223](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L211-L223>)):

View| Description| Components  
---|---|---  
`ExternalAgentThread`| ACP-based agent thread| `Entity<AcpThreadView>`  
`TextThread`| Text-only thread without agent| `Entity<TextThreadEditor>`, title editor, search bar  
`History`| Past conversations| `Entity<AcpThreadHistory>`  
`Configuration`| Agent settings| `Entity<AgentConfiguration>`  
  
### Panel Responsibilities

  * **View Switching** : Transitions between thread, history, and configuration views
  * **Thread Creation** : Spawns new threads based on agent type
  * **Serialization** : Persists panel state (width, selected agent) to key-value store
  * **Menu Management** : Handles navigation menu, options menu, and new thread menu
  * **Zoom Control** : Manages panel zoom state


**Sources** : [crates/agent_ui/src/agent_panel.rs211-223](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L211-L223>) [crates/agent_ui/src/agent_panel.rs418-445](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L418-L445>) [crates/agent_ui/src/agent_panel.rs447-463](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L447-L463>)

* * *

## AcpThreadView: The Primary View

`AcpThreadView` ([crates/agent_ui/src/acp/thread_view.rs264-301](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L264-L301>)) is the main component for displaying and interacting with agent conversations:


### ThreadState Management

**Title: Thread State Machine**


The `ThreadState` enum ([crates/agent_ui/src/acp/thread_view.rs303-319](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L303-L319>)) tracks the thread lifecycle:

State| Description| Contents  
---|---|---  
`Loading(Entity<LoadingView>)`| Connecting to agent server| Load task, status updates  
`Ready { thread, title_editor, mode_selector }`| Thread is active| `Entity<AcpThread>` or `Entity<agent::Thread>`, optional UI controls  
`LoadError(LoadError)`| Failed to connect| Error details (unsupported version, failed install, exit status)  
`Unauthenticated { connection, description, ... }`| Needs authentication| `Rc<dyn AgentConnection>`, auth methods, config view  
  
### View Responsibilities

The `AcpThreadView` manages:

  * **Thread Lifecycle** : Initialization, authentication, error handling
  * **Message Entry** : Coordinates with `MessageEditor` for user input
  * **Thread Display** : Delegates entry rendering to `EntryViewState`
  * **Tool Authorization** : Prompts user for tool call permissions
  * **Model/Mode Selection** : Optional UI for changing agent model or mode
  * **Error Display** : Shows connection errors, authentication issues, version mismatches
  * **Feedback** : Collects user feedback (positive/negative ratings, comments)


**Sources** : [crates/agent_ui/src/acp/thread_view.rs264-301](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L264-L301>) [crates/agent_ui/src/acp/thread_view.rs303-319](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L303-L319>) [crates/agent_ui/src/acp/thread_view.rs327-446](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L327-L446>)

* * *

## Thread Lifecycle

### Initialization Flow

**Title: Thread Creation Sequence**


**Initialization Steps** :

  1. **View Construction** : `AcpThreadView::new()` ([crates/agent_ui/src/acp/thread_view.rs328-446](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L328-L446>)) creates the view with `ThreadState::Loading`
  2. **Connection** : `initial_state()` ([crates/agent_ui/src/acp/thread_view.rs463-721](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L463-L721>)) spawns connection task
  3. **Status Updates** : Loading view displays connection status from agent server
  4. **Thread Creation** : Connection calls `new_thread()` on the agent connection
  5. **Ready State** : View transitions to `ThreadState::Ready` with active thread
  6. **UI Setup** : Creates model selector, mode selector, title editor as needed
  7. **Focus** : Focuses the message editor for user input


### Error Handling

The initialization can fail in several ways:

Error Type| Causes| UI State  
---|---|---  
`LoadError::Unsupported`| Agent version too old| Shows upgrade prompt  
`LoadError::FailedToInstall`| Binary download/install failed| Shows installation error  
`LoadError::Exited`| Agent process crashed| Shows exit status  
`LoadError::Other`| Generic errors| Shows error message  
`AuthRequired`| Authentication needed| Enters `Unauthenticated` state  
  
The view handles errors by:

  * Setting `ThreadState::LoadError` or `Unauthenticated`
  * Displaying error message to user
  * Providing retry option (resets state)
  * Showing authentication UI when applicable


**Sources** : [crates/agent_ui/src/acp/thread_view.rs328-446](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L328-L446>) [crates/agent_ui/src/acp/thread_view.rs463-721](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L463-L721>) [crates/agent_ui/src/acp/thread_view.rs786-802](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L786-L802>) [crates/agent_ui/src/acp/thread_view.rs723-784](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L723-L784>)

### Message Exchange Flow

**Title: User Message Send Flow**


The message editor validates content before sending:

  * Checks for unsupported slash commands
  * Ensures command arguments are provided if required
  * Resolves all mentions to content or resource links


**Sources** : [crates/agent_ui/src/acp/thread_view.rs944-1027](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L944-L1027>) [crates/agent_ui/src/acp/message_editor.rs355-456](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L355-L456>) [crates/agent_ui/src/acp/entry_view_state.rs60-193](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L60-L193>)

### Thread Event Handling

The view subscribes to thread events and updates UI accordingly:

**Title: Thread Event Processing**


Event types handled:

  * `EntryAdded`: New user message, assistant message, or tool call
  * `EntryUpdated`: Streaming updates to existing entries
  * `EntriesRemoved`: When editing/truncating conversation
  * `Stop`: Turn completion with stop reason
  * `ToolAuthorizationRequired`: Prompt for tool permission
  * `Error`: Display error message


**Sources** : [crates/agent_ui/src/acp/thread_view.rs1125-1292](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L1125-L1292>)

* * *

## MessageEditor: User Input Component

The `MessageEditor` ([crates/agent_ui/src/acp/message_editor.rs39-49](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L39-L49>)) provides rich input capabilities for user messages:


### Input Features

**@-Mention System** :

  * Type `@` to trigger completion menu
  * Mention files, directories, symbols, threads, rules, URLs
  * Paste images when agent supports them
  * Drag and drop files to attach


**Slash Commands** :

  * Validated against agent's `available_commands`
  * Inline hints show required arguments
  * Error if unsupported command used


**Content Conversion** :

The editor converts mentions to content blocks:

Mention Type| Content Block Type| Full Content Mode  
---|---|---  
File| `ResourceLink` or `EmbeddedResource`| Embeds file contents if supported  
Directory| `ResourceLink` or `EmbeddedResource`| Includes directory structure  
Symbol| `ResourceLink` or `EmbeddedResource`| Symbol definition + context  
Thread| `ResourceLink` or `EmbeddedResource`| Thread summary or full conversation  
Selection| `ResourceLink` or `EmbeddedResource`| Selected text  
Image| `ImageContent`| Image data + format  
URL| `ResourceLink`| URL for agent to fetch  
  
### Event Handling

The editor emits `MessageEditorEvent`:

Event| Trigger| Handler  
---|---|---  
`Send`| Enter key or Chat action| `AcpThreadView::send()`  
`Cancel`| Escape while sending| `AcpThreadView::cancel_generation()`  
`Focus`| Editor focused| Cancels message editing mode  
`LostFocus`| Editor blurred| (No-op)  
  
**Sources** : [crates/agent_ui/src/acp/message_editor.rs39-204](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L39-L204>) [crates/agent_ui/src/acp/message_editor.rs355-456](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L355-L456>) [crates/agent_ui/src/acp/message_editor.rs473-482](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L473-L482>)

* * *

## EntryViewState: Entry Rendering

`EntryViewState` ([crates/agent_ui/src/acp/entry_view_state.rs23-54](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L23-L54>)) manages the UI representation of thread entries:


### Entry Enum

**Title: Entry Type Hierarchy**


### Entry Synchronization

The `sync_entry()` method ([crates/agent_ui/src/acp/entry_view_state.rs60-193](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L60-L193>)) keeps UI entries in sync with thread entries:

**For UserMessage** :

  1. Creates or updates `MessageEditor` instance
  2. Sets read-only mode if message has no ID (not editable)
  3. Updates content only when not focused (preserves editing)


**For ToolCall** :

  1. Creates `Content` entry with empty HashMap
  2. For each diff: Creates `Entity<Editor>` with diff's multibuffer
  3. For each terminal: Creates `Entity<TerminalView>`
  4. Emits `NewDiff` or `NewTerminal` events for UI notification


**For AssistantMessage** :

  1. Creates or updates `AssistantMessageEntry`
  2. Manages scroll handles for thinking blocks
  3. Auto-scrolls to bottom of streaming thinking blocks


### Content Entity Management

The `Content` variant stores a HashMap mapping `EntityId` to `AnyEntity`. This allows:

  * Multiple diffs per tool call
  * Multiple terminals per tool call
  * Persistent entity references for direct access
  * Downcasting to specific types (`Editor`, `TerminalView`)


Helper methods:

  * `editor_for_diff()`: Returns `Entity<Editor>` for a diff entity
  * `terminal()`: Returns `Entity<TerminalView>` for a terminal entity
  * `scroll_handle_for_assistant_message_chunk()`: Gets scroll handle for thinking block


**Sources** : [crates/agent_ui/src/acp/entry_view_state.rs23-54](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L23-L54>) [crates/agent_ui/src/acp/entry_view_state.rs60-193](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L60-L193>) [crates/agent_ui/src/acp/entry_view_state.rs260-327](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L260-L327>) [crates/agent_ui/src/acp/entry_view_state.rs329-368](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L329-L368>)

* * *

## UI State Management

### Expanded State Tracking

The view tracks which UI elements are expanded ([crates/agent_ui/src/acp/thread_view.rs285-289](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L285-L289>)):


**Expansion Behavior** :

  * Tool calls expand automatically based on `AgentSettings` (`expand_edit_card`, `expand_terminal_card`)
  * Thinking blocks can be toggled individually
  * Message editor can expand to full editor mode
  * Plan view (if present) can be collapsed/expanded
  * Edit cards can be shown/hidden


### Focus Management

The view implements `Focusable` and manages focus across components:

**Title: Focus Hierarchy**


Focus rules:

  * Default focus: Message editor at bottom
  * When editing a message: That message's editor
  * When unauthenticated: View's focus handle (prevents accidental input)
  * When loading/error: View's focus handle


**Sources** : [crates/agent_ui/src/acp/thread_view.rs285-289](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L285-L289>) [crates/agent_ui/src/acp/thread_view.rs440](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L440-L440>)

### Scroll and Following

The view supports auto-scrolling to follow agent output:


Following behavior:

  * Enabled when user sends a message
  * Disabled when user manually scrolls up
  * Auto-scrolls to new entries and updates
  * Scrolls to bottom of thinking blocks
  * Uses `ListState::scroll_to_reveal_item()` for positioning


**Sources** : [crates/agent_ui/src/acp/thread_view.rs290](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L290-L290>)

* * *

## UI Actions and Commands

### Registered Actions

The view registers action handlers in `AgentPanel::init()` ([crates/agent_ui/src/agent_panel.rs83-206](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L83-L206>)):

Action| Handler| Description  
---|---|---  
`NewThread`| `new_thread()`| Creates new native agent thread  
`NewExternalAgentThread`| `external_thread()`| Creates external agent thread  
`NewTextThread`| `new_text_thread()`| Creates text-only thread  
`ExpandMessageEditor`| `expand_message_editor()`| Toggles editor expansion  
`OpenHistory`| `open_history()`| Shows thread history view  
`OpenSettings`| `open_configuration()`| Shows agent settings  
`Follow`| N/A| Follows agent's active location  
`OpenAgentDiff`| N/A| Opens diff pane for thread  
  
### Thread-Specific Actions

Within the thread view ([crates/agent_ui/src/acp/thread_view.rs]):

Action| Method| Description  
---|---|---  
`Chat`| `send()`| Sends current message  
`ChatWithFollow`| `send()` \+ `follow()`| Sends and follows agent  
`Cancel`| `cancel_generation()`| Stops current turn  
`AllowOnce`| `authorize_tool_call()`| Approves tool call once  
`AllowAlways`| `authorize_tool_call()`| Approves tool call always  
`RejectOnce`| `authorize_tool_call()`| Rejects tool call once  
`RejectAll`| `authorize_tool_call()`| Rejects all pending  
`ContinueThread`| `continue_thread()`| Resumes after stop  
`ToggleBurnMode`| `toggle_burn_mode()`| Toggles dangerous mode  
  
**Sources** : [crates/agent_ui/src/agent_panel.rs83-206](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs#L83-L206>) [crates/agent_ui/src/acp/thread_view.rs869-1027](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L869-L1027>)

### Keyboard Shortcuts

Common shortcuts (defined in keymap):

  * `Cmd-Enter` / `Ctrl-Enter`: Send message (Chat)
  * `Escape`: Cancel generation
  * `Cmd-Shift-L`: Toggle model selector
  * `@`: Trigger mention completion
  * `/`: Begin slash command


**Sources** : Default keymap configuration

* * *

## Notifications and Feedback

### Agent Notifications

The view can spawn notification windows ([crates/agent_ui/src/acp/thread_view.rs277-278](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L277-L278>)):


Notifications are used for:

  * Tool call authorization requests (when settings require explicit approval)
  * Authentication prompts
  * Permission dialogs
  * Error alerts


**Notification Lifecycle** :

  1. View creates notification window
  2. Subscribes to notification events
  3. User interacts with notification
  4. Notification emits response event
  5. View handles response and dismisses notification


### User Feedback System

The view implements a feedback mechanism ([crates/agent_ui/src/acp/thread_view.rs142-262](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L142-L262>)):


**Feedback Flow** :

  1. User clicks thumbs up/down on thread
  2. For positive: Immediately submit rating
  3. For negative: Show comments editor
  4. User optionally adds comments
  5. Submit rating + comments to telemetry


Telemetry events:

  * `"Agent Thread Rated"`: Records rating and thread metadata
  * `"Agent Thread Feedback Comments"`: Records detailed feedback


**Sources** : [crates/agent_ui/src/acp/thread_view.rs142-262](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L142-L262>) [crates/agent_ui/src/acp/thread_view.rs277-278](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L277-L278>)

* * *

## Testing Infrastructure

### E2E Test Framework

The `agent_servers` crate provides a test framework for validating agent implementations ([crates/agent_servers/src/e2e_tests.rs19-54](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/e2e_tests.rs#L19-L54>)):


**Common Test Scenarios** :

  * `test_basic`: Basic message exchange
  * `test_path_mentions`: File context attachment
  * `test_tool_call`: Tool execution
  * `test_tool_call_with_permission`: Authorization flow


**Sources** : [crates/agent_servers/src/e2e_tests.rs19-230](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/e2e_tests.rs#L19-L230>)

### Eval System

The `eval` crate provides a benchmarking framework for agent performance ([crates/eval/src/eval.rs1-480](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/eval/src/eval.rs#L1-L480>)):


**Evaluation Workflow** :

  1. Clone test repositories
  2. Run conversation scenarios
  3. Execute assertions on outputs
  4. Judge results using another language model
  5. Aggregate metrics across runs


**Sources** : [crates/eval/src/eval.rs68-335](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/eval/src/eval.rs#L68-L335>) [crates/eval/src/example.rs28-38](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/eval/src/example.rs#L28-L38>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Agent UI and Thread Management](<#agent-ui-and-thread-management>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [UI Component Architecture](<#ui-component-architecture>)
  * [AgentPanel: The Container](<#agentpanel-the-container>)
  * [ActiveView Enum](<#activeview-enum>)
  * [Panel Responsibilities](<#panel-responsibilities>)
  * [AcpThreadView: The Primary View](<#acpthreadview-the-primary-view>)
  * [ThreadState Management](<#threadstate-management>)
  * [View Responsibilities](<#view-responsibilities>)
  * [Thread Lifecycle](<#thread-lifecycle>)
  * [Initialization Flow](<#initialization-flow>)
  * [Error Handling](<#error-handling>)
  * [Message Exchange Flow](<#message-exchange-flow>)
  * [Thread Event Handling](<#thread-event-handling>)
  * [MessageEditor: User Input Component](<#messageeditor-user-input-component>)
  * [Input Features](<#input-features>)
  * [Event Handling](<#event-handling>)
  * [EntryViewState: Entry Rendering](<#entryviewstate-entry-rendering>)
  * [Entry Enum](<#entry-enum>)
  * [Entry Synchronization](<#entry-synchronization>)
  * [Content Entity Management](<#content-entity-management>)
  * [UI State Management](<#ui-state-management>)
  * [Expanded State Tracking](<#expanded-state-tracking>)
  * [Focus Management](<#focus-management>)
  * [Scroll and Following](<#scroll-and-following>)
  * [UI Actions and Commands](<#ui-actions-and-commands>)
  * [Registered Actions](<#registered-actions>)
  * [Thread-Specific Actions](<#thread-specific-actions>)
  * [Keyboard Shortcuts](<#keyboard-shortcuts>)
  * [Notifications and Feedback](<#notifications-and-feedback>)
  * [Agent Notifications](<#agent-notifications>)
  * [User Feedback System](<#user-feedback-system>)
  * [Testing Infrastructure](<#testing-infrastructure>)
  * [E2E Test Framework](<#e2e-test-framework>)
  * [Eval System](<#eval-system>)
