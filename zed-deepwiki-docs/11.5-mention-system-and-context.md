<!-- Source: https://deepwiki.com/zed-industries/zed/11.5-mention-system-and-context -->

# 11.5 Mention System And Context

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Mention System and Context

Relevant source files

  * [crates/acp_thread/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/Cargo.toml>)
  * [crates/acp_thread/src/acp_thread.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs>)
  * [crates/acp_thread/src/connection.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/connection.rs>)
  * [crates/acp_thread/src/mention.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs>)
  * [crates/agent_servers/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/Cargo.toml>)
  * [crates/agent_servers/src/acp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/acp.rs>)
  * [crates/agent_servers/src/agent_servers.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/agent_servers.rs>)
  * [crates/agent_servers/src/claude.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/claude.rs>)
  * [crates/agent_servers/src/custom.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/custom.rs>)
  * [crates/agent_servers/src/e2e_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/e2e_tests.rs>)
  * [crates/agent_servers/src/gemini.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/gemini.rs>)
  * [crates/agent_ui/src/acp/entry_view_state.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs>)
  * [crates/agent_ui/src/acp/message_editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs>)
  * [crates/agent_ui/src/acp/thread_view.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs>)
  * [crates/agent_ui/src/agent_panel.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs>)


The mention system provides a way for users to reference various resources (files, code symbols, threads, URLs, etc.) when communicating with AI agents. These references are converted into structured URIs that can be resolved into content blocks, allowing agents to access relevant context from the user's project.

For information about the overall agent UI and thread management, see [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>). For details about tool execution, see [Tool System](</zed-industries/zed/11.4-tool-system>).

* * *

## Overview

The mention system enables users to type `@` in the message editor to reference resources like files, code symbols, other threads, or web URLs. These mentions are:

  1. Parsed into standardized `MentionUri` types
  2. Resolved to actual content (file contents, symbol definitions, etc.)
  3. Converted to ACP `ContentBlock` types for transmission to agents
  4. Rendered visually in the UI with appropriate icons


**Sources:** [crates/agent_ui/src/acp/message_editor.rs1-700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L1-L700>) [crates/acp_thread/src/mention.rs1-330](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs#L1-L330>)

* * *

## MentionUri Types

`MentionUri` is an enum representing different types of mentions. Each variant maps to a specific URI scheme and format.

### Mention Variants

Variant| Description| Example URI  
---|---|---  
`File`| Reference to a file| `file:///path/to/file.rs`  
`Directory`| Reference to a directory| `file:///path/to/dir/`  
`Symbol`| Code symbol in a file| `file:///file.rs?symbol=MyStruct#L10:20`  
`Selection`| Line range in a file| `file:///file.rs#L5:15`  
`Thread`| Another agent thread| `zed:///agent/thread/session123?name=Thread+name`  
`TextThread`| Text thread reference| `zed:///agent/text-thread/path?name=Thread`  
`Rule`| Prompt rule/template| `zed:///agent/rule/uuid?name=Rule+name`  
`Fetch`| Web URL| `https://example.com/api`  
`PastedImage`| Pasted image data| `zed:///agent/pasted-image`  
  

**Sources:** [crates/acp_thread/src/mention.rs15-49](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs#L15-L49>)

### URI Parsing

The `MentionUri::parse` function converts URI strings into structured mention types. It supports multiple URI schemes:

  * `file://` \- File system resources
  * `zed://` \- Zed-specific resources (threads, rules, etc.)
  * `http://` and `https://` \- Web URLs for fetching


**Line Range Format:** Line ranges use 1-based indexing in URIs but are stored as 0-based internally. Format: `#L<start>:<end>` where both numbers are inclusive line numbers.


**Sources:** [crates/acp_thread/src/mention.rs51-178](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs#L51-L178>)

* * *

## Message Editor Integration

The `MessageEditor` component integrates the mention system with the text editor, providing completion and insertion capabilities.

### Completion Provider

`MessageEditor` uses a `PromptCompletionProvider` that triggers when the user types `@`:


**Sources:** [crates/agent_ui/src/acp/message_editor.rs39-204](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L39-L204>)

### Supported Context Types

The `PromptCompletionProviderDelegate` determines which context types are available based on agent capabilities:

  * **Always supported:** `File`, `Symbol`
  * **Requires`embedded_context` capability:** `Thread`, `Fetch`, `Rules`
  * **Requires`image` capability:** Images


**Sources:** [crates/agent_ui/src/acp/message_editor.rs62-77](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L62-L77>)

### Command Hints

When users type slash commands (e.g., `/search`), the editor displays inline hints for command arguments:

  1. Parse the command name from the buffer
  2. Look up the command in `available_commands`
  3. Extract the hint from `UnstructuredCommandInput`
  4. Display as an inlay hint at the cursor


**Sources:** [crates/agent_ui/src/acp/message_editor.rs206-251](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L206-L251>)

* * *

## Content Conversion

The mention system converts `MentionUri` references into actual content that can be sent to agents.

### Mention to ContentBlock Conversion

The `MessageEditor::contents` method performs the conversion:


**Sources:** [crates/agent_ui/src/acp/message_editor.rs355-456](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L355-L456>)

### ContentBlock Types

Mentions are converted to different `acp::ContentBlock` types based on agent capabilities:

**With`embedded_context` support:**
    
    
    MentionUri::File → acp::ContentBlock::Resource(EmbeddedResource {
        resource: TextResourceContents {
            text: <file contents>,
            uri: "file:///path/to/file.rs"
        }
    })
    

**Without`embedded_context` support:**
    
    
    MentionUri::File → acp::ContentBlock::ResourceLink(ResourceLink {
        title: "file.rs",
        uri: "file:///path/to/file.rs"
    })
    

**For images:**
    
    
    MentionUri::PastedImage → acp::ContentBlock::Image(ImageContent {
        data: <base64 image data>,
        mime_type: "image/png"
    })
    

**Sources:** [crates/agent_ui/src/acp/message_editor.rs375-456](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L375-L456>) [crates/acp_thread/src/acp_thread.rs462-590](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L462-L590>)

* * *

## ContentBlock Representation

The `ContentBlock` enum in `acp_thread` provides a unified interface for different content types received from agents.

### ContentBlock Variants


### Content Accumulation

The `ContentBlock::append` method allows combining multiple content blocks:

  1. If `ContentBlock::Empty`, create new `Markdown` block
  2. If `Markdown`, append to existing markdown entity
  3. If `ResourceLink`, convert to markdown and create new `Markdown` block


This enables streaming content from agents to be accumulated into cohesive blocks.

**Sources:** [crates/acp_thread/src/acp_thread.rs462-590](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L462-L590>)

* * *

## Protocol Integration

### Sending Messages with Mentions

When a user sends a message, the flow is:


**Sources:** [crates/agent_ui/src/acp/message_editor.rs355-456](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L355-L456>) [crates/agent_ui/src/acp/thread_view.rs944-1023](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L944-L1023>)

### Receiving Agent Responses

Agents can return mentions in their responses, which are converted to `ContentBlock`:


**Sources:** [crates/acp_thread/src/acp_thread.rs469-523](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L469-L523>)

* * *

## Implementation Details

### Mention Resolution

The `MentionSet` (not fully visible in provided files) manages the lifecycle of mentions:

  1. **Insertion:** When a completion is confirmed, a crease is inserted in the editor
  2. **Resolution:** The mention is resolved asynchronously (e.g., reading file contents)
  3. **Storage:** Results are cached in a `HashMap<CreaseId, (MentionUri, Mention)>`
  4. **Validation:** Invalid mentions are removed on editor edits


**Sources:** [crates/agent_ui/src/acp/message_editor.rs545-691](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L545-L691>)

### File Clipboard Integration

When users paste code selections with file context from the clipboard:

  1. Check if clipboard contains `editor::ClipboardSelection` metadata
  2. Verify the file is in the current project
  3. For each selection, insert a mention crease with the file path and line range
  4. Resolve the selection to buffer contents asynchronously


**Sources:** [crates/agent_ui/src/acp/message_editor.rs545-691](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L545-L691>)

### Image Support

Images can be pasted if `prompt_capabilities.image` is true:

  1. Detect image data in clipboard
  2. Create `MentionUri::PastedImage`
  3. Convert to `acp::ContentBlock::Image` with base64-encoded data
  4. Include MIME type in the content block


**Sources:** [crates/agent_ui/src/acp/message_editor.rs685-691](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L685-L691>)

### URI Name and Icon Resolution

Each `MentionUri` provides:

  * **`name()`:** Display name (e.g., filename, symbol name, thread title)
  * **`icon_path()`:** Icon based on resource type using `FileIcons` registry


These are used to render creases in the editor UI with appropriate visual indicators.

**Sources:** [crates/acp_thread/src/mention.rs180-216](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs#L180-L216>)

* * *

## Entry View State

The `EntryViewState` manages the visual representation of message entries containing mentions:

### MessageEditor per Entry

Each user message entry gets its own `MessageEditor` instance:

  * Pre-filled with the message content and mentions
  * Can be edited if the message has an ID (not a pending message)
  * Emits `MessageEditorEvent::Focus` when focused for editing


**Sources:** [crates/agent_ui/src/acp/entry_view_state.rs23-225](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L23-L225>)

### Read-Only Messages

Messages without an ID (pending messages being edited) are set to read-only to prevent modification during agent processing.

**Sources:** [crates/agent_ui/src/acp/entry_view_state.rs100-105](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs#L100-L105>)

* * *

## Thread Summary Insertion

Users can reference other threads by inserting a thread summary:


**Process:**

  1. Create `MentionUri::Thread` with thread ID and title
  2. Format as markdown link: `<FileRef file-url="https://github.com/zed-industries/zed/blob/4109c9dd/@Thread Name" undefined file-path="@Thread Name">Hii</FileRef>`
  3. Insert at cursor position
  4. Confirm mention completion to create crease


**Sources:** [crates/agent_ui/src/acp/message_editor.rs253-297](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L253-L297>)

* * *

## Slash Command Validation

Before sending a message, the editor validates that any slash commands used are supported by the agent:


This prevents sending commands the agent doesn't understand.

**Sources:** [crates/agent_ui/src/acp/message_editor.rs322-353](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs#L322-L353>)

* * *

## Summary

The mention system provides a comprehensive framework for referencing context in agent interactions:

  * **Unified representation** via `MentionUri` enum for all resource types
  * **Parser** supporting multiple URI schemes (file, zed, http/https)
  * **Integration** with `MessageEditor` for interactive completion and insertion
  * **Conversion** to ACP `ContentBlock` types based on agent capabilities
  * **Content resolution** handles fetching file contents, web resources, etc.
  * **Visual rendering** with appropriate icons and crease UI elements


This system enables rich, context-aware conversations with AI agents by seamlessly incorporating project resources into prompts.

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Mention System and Context](<#mention-system-and-context>)
  * [Overview](<#overview>)
  * [MentionUri Types](<#mentionuri-types>)
  * [Mention Variants](<#mention-variants>)
  * [URI Parsing](<#uri-parsing>)
  * [Message Editor Integration](<#message-editor-integration>)
  * [Completion Provider](<#completion-provider>)
  * [Supported Context Types](<#supported-context-types>)
  * [Command Hints](<#command-hints>)
  * [Content Conversion](<#content-conversion>)
  * [Mention to ContentBlock Conversion](<#mention-to-contentblock-conversion>)
  * [ContentBlock Types](<#contentblock-types>)
  * [ContentBlock Representation](<#contentblock-representation>)
  * [ContentBlock Variants](<#contentblock-variants>)
  * [Content Accumulation](<#content-accumulation>)
  * [Protocol Integration](<#protocol-integration>)
  * [Sending Messages with Mentions](<#sending-messages-with-mentions>)
  * [Receiving Agent Responses](<#receiving-agent-responses>)
  * [Implementation Details](<#implementation-details>)
  * [Mention Resolution](<#mention-resolution>)
  * [File Clipboard Integration](<#file-clipboard-integration>)
  * [Image Support](<#image-support>)
  * [URI Name and Icon Resolution](<#uri-name-and-icon-resolution>)
  * [Entry View State](<#entry-view-state>)
  * [MessageEditor per Entry](<#messageeditor-per-entry>)
  * [Read-Only Messages](<#read-only-messages>)
  * [Thread Summary Insertion](<#thread-summary-insertion>)
  * [Slash Command Validation](<#slash-command-validation>)
  * [Summary](<#summary>)
