<!-- Source: https://deepwiki.com/zed-industries/zed/10.3-visual-mode -->

# 10.3 Visual Mode

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Visual Mode

Relevant source files

  * [assets/keymaps/vim.json](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json>)
  * [crates/editor/src/selections_collection.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/selections_collection.rs>)
  * [crates/vim/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/Cargo.toml>)
  * [crates/vim/src/command.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/command.rs>)
  * [crates/vim/src/helix.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/helix.rs>)
  * [crates/vim/src/motion.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/motion.rs>)
  * [crates/vim/src/normal.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal.rs>)
  * [crates/vim/src/normal/change.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/change.rs>)
  * [crates/vim/src/normal/delete.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/delete.rs>)
  * [crates/vim/src/normal/mark.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/mark.rs>)
  * [crates/vim/src/normal/paste.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/paste.rs>)
  * [crates/vim/src/normal/yank.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/yank.rs>)
  * [crates/vim/src/object.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/object.rs>)
  * [crates/vim/src/replace.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/replace.rs>)
  * [crates/vim/src/state.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/state.rs>)
  * [crates/vim/src/surrounds.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/surrounds.rs>)
  * [crates/vim/src/test/vim_test_context.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/test/vim_test_context.rs>)
  * [crates/vim/src/vim.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/vim.rs>)
  * [crates/vim/src/visual.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs>)


**Purpose and Scope** : This document describes Zed's implementation of Vim's visual selection modes, including character-wise, line-wise, and block-wise visual modes. Visual mode allows users to select text and then perform operations on the selected region. For information about normal mode operations, see [Normal Mode](</zed-industries/zed/10-vim-mode>). For Helix-style visual mode behavior, see [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>).

## Overview

Visual mode in Zed's Vim emulation provides three distinct selection modes that correspond to Vim's visual modes:

Mode| Trigger| Purpose| Selection Behavior  
---|---|---|---  
`Mode::Visual`| `v`| Character-wise selection| Selects individual characters  
`Mode::VisualLine`| `V` (shift-v)| Line-wise selection| Selects entire lines  
`Mode::VisualBlock`| `ctrl-v` or `ctrl-q`| Block-wise selection| Selects rectangular blocks  
  
All three modes share common infrastructure but differ in how they extend selections and which operations apply to them.

**Sources** : [crates/vim/src/state.rs42-76](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/state.rs#L42-L76>) [assets/keymaps/vim.json72-76](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L72-L76>)

## Mode State and Structure


Visual mode state is tracked through the `Mode` enum variant and additional metadata stored in the `Vim` entity. The `stored_visual_mode` field preserves the previous visual selection for restoration via `g v`.

**Sources** : [crates/vim/src/vim.rs489-515](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/vim.rs#L489-L515>) [crates/vim/src/state.rs42-76](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/state.rs#L42-L76>) [crates/editor/src/selections_collection.rs27-37](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/selections_collection.rs#L27-L37>)

## Entering and Exiting Visual Mode

### Mode Transitions


The selection is stored as `Selection<Anchor>` with `start` and `end` anchors. Motions update the `end` position while the `start` remains fixed (unless using `o` to swap).

**Sources** : [crates/vim/src/visual.rs251-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L251-L318>)

### Line-wise Visual Mode (`Mode::VisualLine`)

Line-wise mode always selects entire lines, regardless of column position. When extending the selection, it snaps to include complete lines.

The implementation expands selections using `expand_to_line`:


**Sources** : [crates/vim/src/visual.rs251-293](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L251-L293>) [crates/editor/src/selections_collection.rs169-179](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/selections_collection.rs#L169-L179>)

### Block-wise Visual Mode (`Mode::VisualBlock`)

Block mode selects a rectangular region of text. Each line in the range has a selection from the anchor column to the cursor column.

Visual block selections create multiple cursors, one per line in the selected region. This allows operations to apply to each line independently.

**Sources** : [crates/vim/src/visual.rs251-293](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L251-L293>)

## Motion Integration

### Extending Selections with Motions

All motion commands available in normal mode can extend visual selections. The `visual_motion` method processes motions differently based on the current visual mode:


**Sources** : [crates/vim/src/visual.rs251-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L251-L318>) [crates/vim/src/motion.rs23-41](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/motion.rs#L23-L41>)

### Text Objects in Visual Mode

Text objects (`iw`, `aw`, `i"`, `a"`, etc.) can be used in visual mode to select structured regions. When a text object is applied, it replaces the current selection:

Command| Object| Around| Example  
---|---|---|---  
`viw`| Word| No| Select inner word  
`vaw`| Word| Yes| Select word with surrounding space  
`vi"`| Quotes| No| Select text inside quotes  
`va"`| Quotes| Yes| Select quotes and text  
`vip`| Paragraph| No| Select paragraph content  
`vap`| Paragraph| Yes| Select paragraph with blank lines  
  
**Sources** : [assets/keymaps/vim.json317-318](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L317-L318>) [crates/vim/src/visual.rs319-366](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L319-L366>)

## Visual Mode Operations

### Delete Operations

Visual mode provides several delete operations that respect the selection mode:

Key| Action| Behavior  
---|---|---  
`d`, `x`| `VisualDelete`| Delete selection (character-wise/block-wise)  
`D`, `X`| `VisualDeleteLine`| Delete entire lines in selection  
  
The `visual_delete` method:

  1. Copies selection content to register (for paste)
  2. Deletes the selected text
  3. Switches back to normal mode
  4. Positions cursor at deletion start


**Sources** : [crates/vim/src/visual.rs376-443](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L376-L443>) [assets/keymaps/vim.json283-287](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L283-L287>)

### Yank (Copy) Operations

Key| Action| Behavior  
---|---|---  
`y`| `VisualYank`| Yank selection maintaining mode  
`Y`| `VisualYankLine`| Yank entire lines  
  
Unlike delete, yank operations keep the visual selection active after copying, allowing for repeated yanks.

**Sources** : [crates/vim/src/visual.rs445-492](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L445-L492>) [assets/keymaps/vim.json288-289](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L288-L289>)

### Change and Substitute Operations

Key| Action| Behavior  
---|---|---  
`c`, `s`| `Substitute`| Delete selection and enter insert mode  
`R`, `S`| `SubstituteLine`| Delete entire lines and enter insert mode  
  
The substitute operations:

  1. Yank the selection to register
  2. Delete the selected text
  3. Switch to insert mode at the deletion point


**Sources** : [crates/vim/src/visual.rs494-554](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L494-L554>) [assets/keymaps/vim.json292-295](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L292-L295>)

### Case Conversion

Key| Action| Effect  
---|---|---  
`~`| `ChangeCase`| Toggle case of selected characters  
`u`| `ConvertToLowerCase`| Convert selection to lowercase  
`U`| `ConvertToUpperCase`| Convert selection to uppercase  
  
**Sources** : [assets/keymaps/vim.json279-280](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L279-L280>) [crates/vim/src/normal/convert.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/convert.rs>)

### Indent Operations

Key| Action| Effect  
---|---|---  
`>`| `Indent`| Increase indentation  
`<`| `Outdent`| Decrease indentation  
`=`| `AutoIndent`| Auto-format indentation  
  
These operations preserve the visual selection after execution, allowing for repeated indentation adjustments.

**Sources** : [assets/keymaps/vim.json313-315](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L313-L315>)

### Special Insert Operations

Visual mode provides special insert commands that work across multiple lines in block or line selections:

Key| Action| Effect  
---|---|---  
`I`| `VisualInsertFirstNonWhiteSpace`| Insert at first non-whitespace of each line  
`A`| `VisualInsertEndOfLine`| Insert at end of each line  
  
In block mode, these create multiple cursors for simultaneous editing.

**Sources** : [crates/vim/src/visual.rs556-662](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L556-L662>) [assets/keymaps/vim.json303-306](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L303-L306>)

## Cursor Movement in Visual Mode

### Other End Navigation

The `OtherEnd` and `OtherEndRowAware` actions allow moving the cursor between the two ends of a selection:

  * `o` (`OtherEndRowAware`): Swaps cursor position, adjusting for display rows
  * `O` (`OtherEnd`): Swaps cursor position at exact points


This allows refining the selection from either end without re-anchoring.

**Sources** : [crates/vim/src/visual.rs664-708](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L664-L708>) [assets/keymaps/vim.json281-282](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L281-L282>)

## Visual Marks and Selection Restoration

### Visual Mark Creation

When exiting visual mode or performing certain operations, Zed creates two marks:

  * `'<` mark: Start of the visual selection
  * `'>` mark: End of the visual selection


These marks persist across mode changes and allow restoration of the previous visual selection.


**Sources** : [crates/vim/src/normal/mark.rs42-74](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/normal/mark.rs#L42-L74>) [crates/vim/src/visual.rs34-43](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L34-L43>)

### Restoring Visual Selection (`g v`)

The `RestoreVisualSelection` action (`g v`) restores the previous visual selection using the stored marks:

  1. Retrieves `'<` and `'>` marks
  2. Retrieves stored mode and reversed flags
  3. Creates visual marks for current selection (if in visual mode)
  4. Switches to the stored visual mode
  5. Restores selections from marks


**Sources** : [crates/vim/src/visual.rs710-755](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L710-L755>) [assets/keymaps/vim.json129](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L129-L129>)

## Multi-Cursor Selection

Visual mode integrates with Zed's multi-cursor functionality through several commands:

Key| Action| Behavior  
---|---|---  
`g n`| `SelectNext`| Add next occurrence to selection  
`g N`| `SelectPrevious`| Add previous occurrence to selection  
`*`| `MoveToNext` (partial word)| Select next partial word match  
`#`| `MoveToPrevious` (partial word)| Select previous partial word match  
  
These commands create multiple cursors, each with its own selection, allowing operations to apply to all matches simultaneously.

**Sources** : [crates/vim/src/visual.rs757-829](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L757-L829>) [assets/keymaps/vim.json297-298](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L297-L298>)

## Paste in Visual Mode

When pasting in visual mode, the selected text is replaced with the paste content:

  1. Current selection is yanked to register (if not preserving clipboard)
  2. Selection is deleted
  3. Paste content is inserted
  4. Mode returns to normal


The `preserve_clipboard` option (when using `g R`) keeps the original clipboard content instead of yanking the deleted selection.

**Sources** : [assets/keymaps/vim.json290-319](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L290-L319>)

## Implementation Architecture

### Core Data Flow


**Sources** : [crates/vim/src/vim.rs1166-1287](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/vim.rs#L1166-L1287>) [crates/vim/src/visual.rs251-443](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#L251-L443>)

### Selection Effects

Visual mode operations use `SelectionEffects` to control scrolling and navigation behavior:


Most visual mode operations use `no_scroll()` to prevent automatic scrolling, allowing users to maintain their viewport position.

**Sources** : [crates/vim/src/visual.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/visual.rs#LNaN-LNaN>)

### Line Mode Flag

The `line_mode` flag in `SelectionsCollection` affects how selections are displayed and processed:


This ensures that line-wise operations always work on complete lines, regardless of cursor column position.

**Sources** : [crates/editor/src/selections_collection.rs27-190](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/selections_collection.rs#L27-L190>)

## Integration with Command Mode

Visual mode selections can be used with command mode operations. When `:` is pressed in visual mode, the command palette opens with the range `'<,'>` pre-filled, indicating the visual selection range.

**Sources** : [assets/keymaps/vim.json278](<https://github.com/zed-industries/zed/blob/4109c9dd/assets/keymaps/vim.json#L278-L278>) [crates/vim/src/command.rs290-296](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/vim/src/command.rs#L290-L296>)


Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Visual Mode](<#visual-mode>)
  * [Overview](<#overview>)
  * [Mode State and Structure](<#mode-state-and-structure>)
  * [Entering and Exiting Visual Mode](<#entering-and-exiting-visual-mode>)
  * [Mode Transitions](<#mode-transitions>)
  * [Toggle Implementation](<#toggle-implementation>)
  * [Selection Behavior by Mode](<#selection-behavior-by-mode>)
  * [Character-wise Visual Mode (`Mode::Visual`)](<#character-wise-visual-mode-modevisual>)
  * [Line-wise Visual Mode (`Mode::VisualLine`)](<#line-wise-visual-mode-modevisualline>)
  * [Block-wise Visual Mode (`Mode::VisualBlock`)](<#block-wise-visual-mode-modevisualblock>)
  * [Motion Integration](<#motion-integration>)
  * [Extending Selections with Motions](<#extending-selections-with-motions>)
  * [Text Objects in Visual Mode](<#text-objects-in-visual-mode>)
  * [Visual Mode Operations](<#visual-mode-operations>)
  * [Delete Operations](<#delete-operations>)
  * [Yank (Copy) Operations](<#yank-copy-operations>)
  * [Change and Substitute Operations](<#change-and-substitute-operations>)
  * [Case Conversion](<#case-conversion>)
  * [Indent Operations](<#indent-operations>)
  * [Special Insert Operations](<#special-insert-operations>)
  * [Cursor Movement in Visual Mode](<#cursor-movement-in-visual-mode>)
  * [Other End Navigation](<#other-end-navigation>)
  * [Visual Marks and Selection Restoration](<#visual-marks-and-selection-restoration>)
  * [Visual Mark Creation](<#visual-mark-creation>)
  * [Restoring Visual Selection (`g v`)](<#restoring-visual-selection-g-v>)
  * [Multi-Cursor Selection](<#multi-cursor-selection>)
  * [Paste in Visual Mode](<#paste-in-visual-mode>)
  * [Implementation Architecture](<#implementation-architecture>)
  * [Core Data Flow](<#core-data-flow>)
  * [Selection Effects](<#selection-effects>)
  * [Line Mode Flag](<#line-mode-flag>)
  * [Integration with Command Mode](<#integration-with-command-mode>)
