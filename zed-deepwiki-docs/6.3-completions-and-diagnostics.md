<!-- Source: https://deepwiki.com/zed-industries/zed/6.3-completions-and-diagnostics -->

# 6.3 Completions And Diagnostics

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Completions and Diagnostics

Relevant source files

  * [crates/buffer_diff/src/buffer_diff.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/buffer_diff/src/buffer_diff.rs>)
  * [crates/collab/src/tests/editor_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/editor_tests.rs>)
  * [crates/collab/src/tests/integration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/integration_tests.rs>)
  * [crates/collab/src/tests/remote_editing_collaboration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/remote_editing_collaboration_tests.rs>)
  * [crates/copilot/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/Cargo.toml>)
  * [crates/copilot/src/copilot.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/copilot.rs>)
  * [crates/copilot/src/sign_in.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/sign_in.rs>)
  * [crates/editor/src/actions.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/actions.rs>)
  * [crates/editor/src/code_completion_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_completion_tests.rs>)
  * [crates/editor/src/code_context_menus.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs>)
  * [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>)
  * [crates/editor/src/editor_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor_tests.rs>)
  * [crates/editor/src/element.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/element.rs>)
  * [crates/editor/src/hover_links.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/hover_links.rs>)
  * [crates/fs/src/fs.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fs.rs>)
  * [crates/git/src/status.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/status.rs>)
  * [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>)
  * [crates/language/src/buffer_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer_tests.rs>)
  * [crates/language/src/syntax_map.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/syntax_map.rs>)
  * [crates/lsp/src/lsp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/lsp/src/lsp.rs>)
  * [crates/multi_buffer/src/anchor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/anchor.rs>)
  * [crates/multi_buffer/src/multi_buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/multi_buffer.rs>)
  * [crates/multi_buffer/src/multi_buffer_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/multi_buffer_tests.rs>)
  * [crates/prettier/src/prettier.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier.rs>)
  * [crates/prettier/src/prettier_server.js](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier_server.js>)
  * [crates/project/src/buffer_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs>)
  * [crates/project/src/lsp_command.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs>)
  * [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>)
  * [crates/project/src/prettier_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/prettier_store.rs>)
  * [crates/project/src/project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs>)
  * [crates/project/src/project_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project_tests.rs>)
  * [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>)
  * [crates/proto/proto/lsp.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto>)
  * [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)
  * [crates/remote_server/src/remote_editing_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/remote_editing_tests.rs>)
  * [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>)
  * [crates/worktree/src/worktree_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs>)


This document describes how Zed provides code completions (auto-complete suggestions) and displays diagnostics (errors, warnings, hints) from language servers and other sources. For information about Language Server Protocol integration overall, see [LSP Integration](</zed-industries/zed/3.1-editor-component-and-ui>). For AI-powered edit predictions shown inline, see [Edit Prediction System](</zed-industries/zed/5.1-project-orchestration>).

## Overview

Zed's completions and diagnostics system bridges the Editor UI with language intelligence backends. Completions appear in a context menu as users type, offering suggestions from LSP servers, word-based completion, and snippets. Diagnostics highlight issues in the code with squiggles, gutter indicators, and detailed error messages. Both systems support multiple language servers per buffer and provide rich, interactive UI elements.

**Key capabilities:**

  * LSP-based code completions with documentation previews
  * Multi-source completion providers (language servers, snippets, words)
  * Real-time diagnostic updates via push and pull protocols
  * Inline diagnostic display with configurable severity filtering
  * Completion resolution for additional details on-demand
  * Diagnostic navigation commands


* * *

## Completions Architecture

### Completion Request Flow


**Title** : Completion Request and Resolution Flow

This diagram shows the complete lifecycle from user input to displaying completions. The Editor coordinates requests through the Project and LspStore layers, which communicate with potentially multiple language servers. Resolution happens lazily when the user selects an item.

Sources: [crates/editor/src/editor.rs6500-6700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L6500-L6700>) [crates/project/src/lsp_command.rs200-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L200-L400>) [crates/project/src/lsp_store.rs3500-3800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3500-L3800>)

* * *

### Completion Data Structures

The completion system uses several key types to represent suggestions from different sources:

Type| Location| Purpose  
---|---|---  
`Completion`| `project/src/lsp_command.rs`| High-level completion with label, documentation, source  
`CoreCompletion`| `project/src/lsp_command.rs`| LSP completion converted from `lsp::CompletionItem`  
`CompletionResponse`| `project/src/lsp_command.rs`| Wrapper containing completions and context  
`CompletionsMenu`| `editor/src/code_context_menus.rs`| UI state for rendering completion menu  
`CompletionDocumentation`| `project/src/lsp_store.rs`| Documentation content (markdown or plaintext)  
  

**Title** : Completion Type Hierarchy

This diagram shows how completion data flows through typed structures from LSP responses to Editor UI. The `Editor` delegates to `CompletionProvider` (implemented by `Project`), which uses `LspStore` for LSP communication.

Sources: [crates/editor/src/editor.rs1089-1098](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1089-L1098>) [crates/editor/src/code_context_menus.rs69-127](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs#L69-L127>) [crates/project/src/lsp_command.rs38-95](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L38-L95>)

* * *

### Completion Triggers and Context

Completions can be triggered in three ways:

  1. **Automatic triggers** : Based on characters configured by the language server
  2. **Manual triggers** : Via `editor::ShowCompletions` action
  3. **Re-trigger** : After accepting a completion that indicates more completions available


**Title** : Completion Trigger and Context Resolution

This diagram illustrates how completion requests are initiated. The editor checks trigger characters stored in `completion_triggers` (populated from LSP server capabilities), builds context about the cursor position and preceding text, then dispatches the request.

Sources: [crates/editor/src/editor.rs6500-6550](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L6500-L6550>) [crates/language/src/buffer.rs122-124](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs#L122-L124>) [crates/project/src/lsp_store.rs3500-3600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3500-L3600>)

* * *

### Completion Menu Rendering

The `CompletionsMenu` is responsible for displaying, filtering, and managing user interaction with completion items.

**Key components** ([crates/editor/src/code_context_menus.rs130-350](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs#L130-L350>)):

  * `completions: Arc<Vec<Completion>>` \- Full list of available completions
  * `match_candidates: Vec<StringMatch>` \- Filtered/sorted results based on query
  * `selected_item: usize` \- Currently highlighted item
  * `markdown_cache: Rc<RefCell<CompletionMarkdownCache>>` \- Caches parsed documentation
  * `pending_resolve: HashMap<usize, Task<()>>` \- In-flight resolution requests


The menu performs **fuzzy matching** against the completion labels as the user types, re-ranking results based on match quality. It also implements a **documentation preview** system that shows rich markdown content for the selected completion.


**Title** : Completion Menu Rendering and Interaction

The menu uses `uniform_list` for efficient rendering of potentially large completion lists. Documentation is parsed into markdown entities and cached to reduce flickering when navigating items.

Sources: [crates/editor/src/code_context_menus.rs500-800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs#L500-L800>) [crates/editor/src/code_context_menus.rs56-64](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs#L56-L64>)

* * *

### Completion Resolution

Many language servers return "incomplete" completion items initially, requiring a secondary `completionItem/resolve` request to fetch full details like documentation or additional text edits.

**Resolution lifecycle** :

  1. **Initial fetch** : Server returns `CompletionItem` with `data` field for resolution
  2. **User selection** : When user navigates to an item, resolution is triggered
  3. **Resolve request** : `LspStore::resolve_completion()` sends LSP request
  4. **Update UI** : Documentation appears in menu's aside panel


**Title** : Completion Resolution Flow

Resolution happens asynchronously and doesn't block the UI. The menu maintains pending resolution tasks and updates when they complete.

Sources: [crates/editor/src/code_context_menus.rs450-550](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs#L450-L550>) [crates/project/src/lsp_command.rs500-600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L500-L600>) [crates/project/src/lsp_store.rs3900-4000](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3900-L4000>)

* * *

### Completion Sources

Zed aggregates completions from multiple sources:

Source| Type| Implementation  
---|---|---  
LSP Servers| Language-aware| `LspStore::code_completions()`  
Snippets| User-defined templates| `SnippetProvider`  
Words| Buffer word extraction| Word completion mode in settings  
Edit Predictions| AI-powered| `EditPredictionProvider` (see [5.1](</zed-industries/zed/5.1-project-orchestration>))  
  
**LSP completion flow** ([crates/project/src/lsp_store.rs3500-3800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3500-L3800>)):


Sources: [crates/project/src/lsp_store.rs3500-3850](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3500-L3850>) [crates/editor/src/editor.rs6500-6700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L6500-L6700>)

* * *

## Diagnostics Architecture

### Diagnostic Update Flow

Diagnostics in Zed support both **push** (server sends diagnostics unsolicited) and **pull** (client requests diagnostics) models defined in the LSP specification.


**Title** : Diagnostic Push and Pull Flow

The `LspStore` handles both notification-based and request-based diagnostic updates, storing them in a hierarchical structure (worktree → path → server → diagnostics). The `Buffer` maintains a `DiagnosticSet` for efficient querying.

Sources: [crates/project/src/lsp_store.rs5500-5800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L5500-L5800>) [crates/language/src/buffer.rs119](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs#L119-L119>) [crates/editor/src/editor.rs1049-1056](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1049-L1056>)

* * *

### Diagnostic Storage Structure


**Title** : Diagnostic Storage Hierarchy

Diagnostics are stored at three levels:

  1. **LspStore** : Global view of all diagnostics across worktrees/paths
  2. **Buffer** : Per-buffer diagnostics from each language server (using `DiagnosticSet` for efficient range queries)
  3. **Editor** : Inline diagnostic display state for visible regions


This multi-level storage enables efficient updates and queries while supporting multiple language servers per buffer.

Sources: [crates/project/src/lsp_store.rs271-282](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L271-L282>) [crates/language/src/buffer.rs119](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs#L119-L119>) [crates/editor/src/editor.rs1049-1056](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1049-L1056>)

* * *

### Diagnostic Display

The Editor renders diagnostics in multiple ways:

**Display modes** :

  1. **Inline diagnostics** : Text annotations shown below problematic lines
  2. **Gutter indicators** : Icons in the line number gutter
  3. **Squiggles** : Colored underlines on the affected ranges
  4. **Status bar summary** : Aggregate counts by severity


**Title** : Diagnostic Display Pipeline

The `update_inline_diagnostics()` method ([crates/editor/src/editor.rs8500-8700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L8500-L8700>)) periodically refreshes which diagnostics are shown inline based on the current viewport. Diagnostics are grouped by line, and the most severe one is displayed.

Sources: [crates/editor/src/editor.rs8500-8700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L8500-L8700>) [crates/editor/src/element.rs2500-2700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/element.rs#L2500-L2700>)

* * *

### Diagnostic Navigation

Users can navigate between diagnostics using actions:

Action| Default Keybinding| Behavior  
---|---|---  
`GoToDiagnostic`| F8 (macOS)| Move to next diagnostic  
`GoToPrevDiagnostic`| Shift-F8 (macOS)| Move to previous diagnostic  
  
**Filtering by severity** ([crates/editor/src/editor.rs9500-9700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L9500-L9700>)):


The navigation system:

  1. Collects diagnostics from all language servers for the buffer
  2. Filters by user-specified severity range
  3. Finds next/previous diagnostic relative to cursor position
  4. Moves cursor and scrolls to make diagnostic visible
  5. Shows diagnostic details in hover or inline


**Title** : Diagnostic Navigation Flow

Navigation respects multiple cursors and can jump across buffers in multi-buffer editors.

Sources: [crates/editor/src/editor.rs9500-9800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L9500-L9800>) [crates/editor/src/actions.rs250-270](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/actions.rs#L250-L270>)

* * *

### Pull Diagnostics Protocol

Zed supports the newer LSP pull diagnostics model (LSP 3.17+), which gives the client control over when diagnostics are requested.

**Key components** :

  * `buffer_pull_diagnostics_result_ids`: Tracks result IDs per document for incremental updates
  * `workspace_pull_diagnostics_result_ids`: Tracks workspace-wide diagnostic results
  * Dynamic registration support via `client/registerCapability`


**Pull diagnostics request flow** ([crates/project/src/lsp_store.rs5900-6200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L5900-L6200>)):

  1. Buffer opened → Send `textDocument/diagnostic` with previous `resultId`
  2. Server responds with either: 
     * **Full report** : New diagnostics + new `resultId`
     * **Unchanged** : `resultId` matches, no update needed
  3. Store new `resultId` for next request
  4. Apply diagnostics to buffer


This reduces redundant diagnostic transfers when documents haven't changed.


**Title** : Pull Diagnostics Request with Result ID Caching

The result ID mechanism enables incremental diagnostics, reducing bandwidth and processing overhead.

Sources: [crates/project/src/lsp_store.rs5900-6200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L5900-L6200>) [crates/project/src/lsp_store.rs288-295](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L288-L295>)

* * *

## Integration with Editor

### Completion Integration Points

**Editor → Completions** :

  * `show_completions()` \- Initiates completion request ([crates/editor/src/editor.rs6500-6550](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L6500-L6550>))
  * `confirm_completion()` \- Applies selected completion ([crates/editor/src/editor.rs6900-7100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L6900-L7100>))
  * `context_menu_next()` \- Navigate completion list
  * `is_completion_trigger()` \- Checks if character triggers completions


**Completions → Editor** :

  * `CodeContextMenu` stored in `Editor.context_menu`
  * Renders above/below cursor based on available space
  * Completion tasks tracked in `Editor.completion_tasks`


### Diagnostic Integration Points

**LSP → Diagnostics** :

  * `textDocument/publishDiagnostics` notification handler
  * `textDocument/diagnostic` request for pull model
  * Dynamic registration of diagnostic capabilities


**Diagnostics → Editor** :

  * `inline_diagnostics` field contains visible inline diagnostic annotations
  * `active_diagnostics` tracks diagnostics at cursor for tooltips
  * `diagnostics_max_severity` drives gutter icon display
  * Editor observes buffer `DiagnosticsUpdated` events


### Event Flow


**Title** : Editor Integration Event Flow

The editor coordinates between user actions, LSP events, and buffer changes to keep completions and diagnostics up-to-date.

Sources: [crates/editor/src/editor.rs6500-6700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L6500-L6700>) [crates/editor/src/editor.rs8500-8700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L8500-L8700>) [crates/project/src/lsp_store.rs5500-5800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L5500-L5800>)

* * *

## Summary

Zed's completions and diagnostics system provides real-time language intelligence through:

  1. **Multi-source completions** : LSP servers, snippets, word-based, and AI providers
  2. **Rich UI** : Fuzzy-matched menus with documentation previews and markdown rendering
  3. **Efficient diagnostics** : Multi-level storage supporting multiple servers with push/pull protocols
  4. **Flexible display** : Inline diagnostics, gutter indicators, squiggles, and navigation commands
  5. **Async architecture** : Non-blocking completion resolution and diagnostic updates


The system is designed to scale to large codebases with multiple language servers per buffer, providing consistent UX across all supported languages.

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Completions and Diagnostics](<#completions-and-diagnostics>)
  * [Overview](<#overview>)
  * [Completions Architecture](<#completions-architecture>)
  * [Completion Request Flow](<#completion-request-flow>)
  * [Completion Data Structures](<#completion-data-structures>)
  * [Completion Triggers and Context](<#completion-triggers-and-context>)
  * [Completion Menu Rendering](<#completion-menu-rendering>)
  * [Completion Resolution](<#completion-resolution>)
  * [Completion Sources](<#completion-sources>)
  * [Diagnostics Architecture](<#diagnostics-architecture>)
  * [Diagnostic Update Flow](<#diagnostic-update-flow>)
  * [Diagnostic Storage Structure](<#diagnostic-storage-structure>)
  * [Diagnostic Display](<#diagnostic-display>)
  * [Diagnostic Navigation](<#diagnostic-navigation>)
  * [Pull Diagnostics Protocol](<#pull-diagnostics-protocol>)
  * [Integration with Editor](<#integration-with-editor>)
  * [Completion Integration Points](<#completion-integration-points>)
  * [Diagnostic Integration Points](<#diagnostic-integration-points>)
  * [Event Flow](<#event-flow>)
  * [Summary](<#summary>)
