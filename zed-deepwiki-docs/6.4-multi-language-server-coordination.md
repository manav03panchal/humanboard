<!-- Source: https://deepwiki.com/zed-industries/zed/6.4-multi-language-server-coordination -->

# 6.4 Multi Language Server Coordination

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Multi-Language Server Coordination

Relevant source files

  * [crates/collab/src/tests/editor_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/editor_tests.rs>)
  * [crates/collab/src/tests/integration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/integration_tests.rs>)
  * [crates/collab/src/tests/remote_editing_collaboration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/remote_editing_collaboration_tests.rs>)
  * [crates/copilot/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/Cargo.toml>)
  * [crates/copilot/src/copilot.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/copilot.rs>)
  * [crates/copilot/src/sign_in.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/sign_in.rs>)
  * [crates/editor/src/hover_links.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/hover_links.rs>)
  * [crates/fs/src/fs.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fs.rs>)
  * [crates/git/src/status.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/status.rs>)
  * [crates/lsp/src/lsp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/lsp/src/lsp.rs>)
  * [crates/prettier/src/prettier.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier.rs>)
  * [crates/prettier/src/prettier_server.js](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier_server.js>)
  * [crates/project/src/buffer_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs>)
  * [crates/project/src/lsp_command.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs>)
  * [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>)
  * [crates/project/src/prettier_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/prettier_store.rs>)
  * [crates/project/src/project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs>)
  * [crates/project/src/project_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project_tests.rs>)
  * [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>)
  * [crates/proto/proto/lsp.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto>)
  * [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)
  * [crates/remote_server/src/remote_editing_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/remote_editing_tests.rs>)
  * [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>)
  * [crates/worktree/src/worktree_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs>)


## Purpose and Scope

This page documents how Zed manages and coordinates multiple language servers running simultaneously within a project. This includes:

  * Running multiple instances of the same language server for different project roots or configurations
  * Determining which buffers should be registered with which servers
  * Routing LSP requests to the appropriate server(s)
  * Merging responses from multiple servers


For information about the overall LSP store architecture, see [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>). For individual language server lifecycle management, see [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>).

## Server Multiplicity

Zed can run multiple language servers for the same language simultaneously for several reasons:

### Reasons for Multiple Servers

Reason| Description| Example  
---|---|---  
**Different Worktrees**|  Each worktree may need its own server instance| Multiple project folders open  
**Different Project Roots**|  Manifest-based servers scope to project boundaries| Python projects with `pyproject.toml`  
**Different Toolchains**|  Servers may require specific runtime versions| Node 16 vs Node 18 projects  
**Different Settings**|  Per-language-server configuration can vary| Custom LSP initialization options  
**Supplementary Servers**|  Additional servers providing specialized features| Tailwind CSS alongside TypeScript  
  
Sources: [crates/project/src/lsp_store.rs254-299](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L254-L299>) [crates/project/src/project_tests.rs607-711](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project_tests.rs#L607-L711>)

## Server Identification and Deduplication

### LanguageServerSeed

Language servers are identified by a `LanguageServerSeed` structure that serves as a deduplication key:


This seed determines whether a new server should be started or an existing one reused. Two requests with the same seed will share a server instance.

Sources: [crates/project/src/lsp_store.rs225-231](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L225-L231>)

### UnifiedLanguageServer

Once a server is identified by its seed, it maps to a `UnifiedLanguageServer`:


The `project_roots` field tracks all paths this server is responsible for, allowing a single server instance to handle multiple directories within its scope.

Sources: [crates/project/src/lsp_store.rs219-223](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L219-L223>)

### Deduplication Process


**Deduplication Flow** : When opening a buffer, Zed creates a seed and checks if a matching server already exists before starting a new one.

Sources: [crates/project/src/lsp_store.rs315-357](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L315-L357>)

## Manifest-Based Server Scoping

### Manifest Providers

Manifest providers determine project boundaries within a worktree, allowing multiple server instances to coexist in a single worktree directory:


**Manifest-Based Isolation** : Different projects within the same worktree get separate server instances based on manifest file detection.

Sources: [crates/project/src/project_tests.rs610-634](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project_tests.rs#L610-L634>) [crates/project/src/manifest_tree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/manifest_tree.rs>)

### LaunchDisposition

The `ManifestTree` produces `LaunchDisposition` structures that specify how to launch servers:


Each disposition identifies a unique server instance based on its location and configuration.

Sources: [crates/project/src/manifest_tree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/manifest_tree.rs>)

## Buffer-Server Registration

### Registration Tracking

The LSP store maintains several data structures to track buffer-server relationships:


**Buffer Registration State** : Multiple data structures work together to track which buffers are opened in which servers.

Sources: [crates/project/src/lsp_store.rs286-299](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L286-L299>)

### Registration Process

When a buffer needs to be registered with language servers:

  1. **Determine Applicable Servers** : Query `ManifestTree` for servers that should handle this buffer's path
  2. **Check Registration Status** : Look up buffer in `buffers_opened_in_servers` to avoid duplicate registration
  3. **Send DidOpen Notification** : Call `lsp::notification::DidOpenTextDocument` for each applicable server
  4. **Track Registration** : Add server ID to the buffer's set in `buffers_opened_in_servers`
  5. **Store Snapshot** : Save buffer version in `buffer_snapshots` for future synchronization


Sources: [crates/project/src/lsp_store.rs1900-2100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L1900-L2100>)

### Multiple Server Registration Example

A TypeScript file might be registered with:

  * **TypeScript Language Server** : Core language features (completions, diagnostics, etc.)
  * **Tailwind CSS Language Server** : CSS class completions and validation
  * **ESLint Language Server** : Linting and code style checking


Each server receives `DidOpenTextDocument` and subsequent `DidChangeTextDocument` notifications independently.

## Request Routing and Response Aggregation

### Server Selection

Different LSP operations require different server selection strategies:


**Request Routing Strategy** : Different LSP operations use different strategies for selecting which servers to query.

Sources: [crates/project/src/lsp_command.rs1-500](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L1-L500>)

### Response Merging

When requests go to multiple servers, responses must be merged:

#### Completions

Completion results from multiple servers are concatenated and deduplicated based on:

  * Label text
  * Insert range
  * Snippet deduplication keys


Sources: [crates/project/src/lsp_store.rs3800-4000](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3800-L4000>)

#### Diagnostics

Diagnostics from multiple servers are merged per-buffer:


Each server's diagnostics are kept separate to allow filtering and attribution, but are all displayed together in the editor.

Sources: [crates/project/src/lsp_store.rs276-285](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L276-L285>)

#### Code Actions

Code actions are aggregated from all servers and presented in a unified menu, with each action retaining its source server ID for execution:


Sources: [crates/project/src/project.rs653-665](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs#L653-L665>)

## Supplementary Language Servers

### Definition

Supplementary language servers are additional servers that provide features for a language but don't replace the primary server:


Sources: [crates/project/src/lsp_store.rs272-273](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L272-L273>)

### Use Cases

Primary Server| Supplementary Server| Purpose  
---|---|---  
TypeScript| Tailwind CSS| CSS class completions  
TypeScript| ESLint| Linting  
HTML| Emmet| Snippet expansion  
Vue| Vetur/Volar| Framework-specific features  
  
### Registration and Lifecycle

Supplementary servers:

  1. Are registered alongside the primary server for a language
  2. Receive the same buffer notifications (`DidOpen`, `DidChange`, etc.)
  3. Contribute to aggregated responses (completions, diagnostics, code actions)
  4. Are shut down when the primary server shuts down or when no longer needed


Sources: [crates/project/src/lsp_store.rs272-273](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L272-L273>)

## Request Execution Flow

### Complete Flow for Multi-Server Request


**Multi-Server Request Flow** : A single completion request may query multiple servers and merge their responses.

Sources: [crates/project/src/lsp_store.rs3800-4200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L3800-L4200>) [crates/project/src/lsp_command.rs200-300](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L200-L300>)

## Server Coordination Challenges

### Conflicting Diagnostics

When multiple servers report diagnostics for the same range:

  * Each server's diagnostics are displayed with attribution
  * No automatic deduplication occurs to preserve all information
  * UI may show multiple diagnostic indicators for the same location


Sources: [crates/project/src/lsp_store.rs5200-5400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L5200-L5400>)

### Formatting Conflicts

Only one server handles formatting per request:

  * The primary server for the language is used
  * Settings can specify which server via `language_servers` configuration
  * Multiple formatters for the same file must be configured as alternatives, not simultaneously


Sources: [crates/project/src/lsp_store.rs6000-6300](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L6000-L6300>)

### Workspace Folder Management

Each server maintains its own workspace folders:

  * Servers track folders via `workspace_folders` in `LanguageServer`
  * New folders are added via `workspace/didChangeWorkspaceFolders` notification
  * Folders are scoped to server boundaries defined by manifest detection


Sources: [crates/lsp/src/lsp.rs108-110](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/lsp/src/lsp.rs#L108-L110>) [crates/project/src/lsp_store.rs390-392](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L390-L392>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Multi-Language Server Coordination](<#multi-language-server-coordination>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [Server Multiplicity](<#server-multiplicity>)
  * [Reasons for Multiple Servers](<#reasons-for-multiple-servers>)
  * [Server Identification and Deduplication](<#server-identification-and-deduplication>)
  * [LanguageServerSeed](<#languageserverseed>)
  * [UnifiedLanguageServer](<#unifiedlanguageserver>)
  * [Deduplication Process](<#deduplication-process>)
  * [Manifest-Based Server Scoping](<#manifest-based-server-scoping>)
  * [Manifest Providers](<#manifest-providers>)
  * [LaunchDisposition](<#launchdisposition>)
  * [Buffer-Server Registration](<#buffer-server-registration>)
  * [Registration Tracking](<#registration-tracking>)
  * [Registration Process](<#registration-process>)
  * [Multiple Server Registration Example](<#multiple-server-registration-example>)
  * [Request Routing and Response Aggregation](<#request-routing-and-response-aggregation>)
  * [Server Selection](<#server-selection>)
  * [Response Merging](<#response-merging>)
  * [Completions](<#completions>)
  * [Diagnostics](<#diagnostics>)
  * [Code Actions](<#code-actions>)
  * [Supplementary Language Servers](<#supplementary-language-servers>)
  * [Definition](<#definition>)
  * [Use Cases](<#use-cases>)
  * [Registration and Lifecycle](<#registration-and-lifecycle>)
  * [Request Execution Flow](<#request-execution-flow>)
  * [Complete Flow for Multi-Server Request](<#complete-flow-for-multi-server-request>)
  * [Server Coordination Challenges](<#server-coordination-challenges>)
  * [Conflicting Diagnostics](<#conflicting-diagnostics>)
  * [Formatting Conflicts](<#formatting-conflicts>)
  * [Workspace Folder Management](<#workspace-folder-management>)
