<!-- Source: https://deepwiki.com/zed-industries/zed/3.4-selections-and-editing-operations -->

# 3.4 Selections And Editing Operations

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Selections and Editing Operations

Relevant source files

  * [crates/buffer_diff/src/buffer_diff.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/buffer_diff/src/buffer_diff.rs>)
  * [crates/editor/src/actions.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/actions.rs>)
  * [crates/editor/src/code_completion_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_completion_tests.rs>)
  * [crates/editor/src/code_context_menus.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/code_context_menus.rs>)
  * [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>)
  * [crates/editor/src/editor_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor_tests.rs>)
  * [crates/editor/src/element.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/element.rs>)
  * [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>)
  * [crates/language/src/buffer_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer_tests.rs>)
  * [crates/language/src/syntax_map.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/syntax_map.rs>)
  * [crates/multi_buffer/src/anchor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/anchor.rs>)
  * [crates/multi_buffer/src/multi_buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/multi_buffer.rs>)
  * [crates/multi_buffer/src/multi_buffer_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/multi_buffer_tests.rs>)


## Purpose and Scope

This document describes how Zed manages text selections and performs editing operations within the `Editor` component. It covers the data structures representing selections, the mechanisms for creating and manipulating selections (via mouse and keyboard), multi-cursor editing, and the transaction system that groups edits for undo/redo.

For information about the display of selections and cursor rendering, see the rendering pipeline in [3.3](</zed-industries/zed/3.3-display-pipeline-and-rendering>). For information about the underlying text storage that selections reference, see [3.2](</zed-industries/zed/3.2-buffer-system-and-text-storage>).

* * *

## Core Selection Data Structures

### Selection and Anchor

A `Selection<T>` represents a range of text with a directional cursor. The type parameter `T` is typically either `Anchor` (stable across edits) or `Point`/`DisplayPoint` (ephemeral coordinates).


**Key Properties:**

  * **head** : The cursor position where the selection ends (equals `end` if not reversed, `start` if reversed)
  * **tail** : The anchor position where the selection began (opposite of head)
  * **reversed** : Whether the selection was made backwards (head < tail)
  * **goal** : Maintains desired column position when moving vertically across lines of different lengths


**Sources:** [crates/language/src/buffer.rs64](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs#L64-L64>) [crates/multi_buffer/src/anchor.rs12-16](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/anchor.rs#L12-L16>)

* * *

### SelectionsCollection

The `SelectionsCollection` manages all selections in an editor and enforces invariants.


**Invariants Maintained:**

  * Selections are kept in sorted, non-overlapping order by their buffer ranges
  * Overlapping selections are automatically merged
  * Each selection has a unique ID that persists across edits
  * The "newest" selection is tracked for operations like "select next"


**Sources:** [crates/editor/src/editor.rs1036](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1036-L1036>) [crates/editor/src/selections_collection.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/selections_collection.rs>)

* * *

## Mouse-Based Selection

### SelectPhase State Machine

Mouse selection progresses through phases tracked by the `SelectPhase` enum:


**Sources:** [crates/editor/src/editor.rs427-450](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L427-L450>)

### Click Count Selection Modes

Different click counts trigger different selection granularities:

Click Count| Selection Mode| Behavior  
---|---|---  
1 (Single)| Character| Places cursor or selects character range  
2 (Double)| Word| Selects entire word under cursor  
3 (Triple)| Line| Selects entire line including newline  
  
**Implementation Flow:**


**Sources:** [crates/editor/src/editor.rs428-457](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L428-L457>) [crates/editor/src/element.rs225-393](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/element.rs#L225-L393>) [crates/editor/src/editor_tests.rs430-531](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor_tests.rs#L430-L531>)

* * *

## Keyboard-Based Selection

### Movement with Selection Extension

Movement actions can extend selections by holding Shift. The editor maintains a `SelectionGoal` to preserve horizontal position.


**Key Methods:**

  * `move_selections()` \- Core method for moving/extending selections
  * `select_left()`, `select_right()` \- Character-based extension
  * `select_up()`, `select_down()` \- Line-based extension with goal preservation
  * `select_to_beginning_of_line()`, `select_to_end_of_line()` \- Line boundary extension


**Sources:** [crates/editor/src/actions.rs27-91](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/actions.rs#L27-L91>) [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>)

* * *

## Multi-Cursor Operations

### Add Selection Above/Below

Creates new cursors above or below existing cursors while preserving column alignment:


**Implementation Details:**

  * Maintains goal column across varying line lengths
  * Skips soft-wrapped positions by default
  * Automatically merges if cursors would overlap
  * Each new selection becomes the "newest" selection


**Sources:** [crates/editor/src/actions.rs313-328](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/actions.rs#L313-L328>) [crates/editor/src/editor.rs3068-3203](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L3068-L3203>)

* * *

### Select Next/Previous Occurrence

Finds and selects the next/previous occurrence of the currently selected text, enabling multi-cursor editing of matching text:


**Features:**

  * **Whole word matching** : Only matches complete words if initial selection was a whole word
  * **Case sensitivity** : Preserves case from the query text
  * **Skip mode** : `replace_newest: true` replaces the current selection instead of adding
  * **Wraparound** : Searches from beginning if no match found after current position


**Sources:** [crates/editor/src/actions.rs8-24](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/actions.rs#L8-L24>) [crates/editor/src/editor.rs3205-3567](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L3205-L3567>) [crates/editor/src/editor_tests.rs668-804](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor_tests.rs#L668-L804>)

* * *

### Columnar (Block) Selection

Columnar selection creates rectangular selections across multiple lines:


**Creation Methods:**

  * **Mouse** : Alt/Option + drag creates columnar selection
  * **Keyboard** : Platform-specific keybindings toggle columnar mode for existing selection


**Sources:** [crates/editor/src/editor.rs434-438](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L434-L438>) [crates/editor/src/editor.rs452-456](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L452-L456>) [crates/editor/src/editor.rs1003-1011](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1003-L1011>)

* * *

## Editing Operations

### Text Insertion and Deletion

Text modifications flow through the `Editor` to the underlying `MultiBuffer`:


**Key Methods:**

  * `insert()` \- Inserts text at each selection, replacing any selected text
  * `delete()` \- Deletes character after cursor or selected text
  * `backspace()` \- Deletes character before cursor or selected text
  * `newline()` \- Inserts newline with autoindentation
  * `handle_input()` \- Processes typed text, handles autocompletion


**Sources:** [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>) [crates/multi_buffer/src/multi_buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/multi_buffer.rs>)

* * *

### Transaction System and Grouping

Edits are grouped into transactions for atomic undo/redo:


**Transaction Grouping Rules:**

  * Edits within the `group_interval` (typically 300ms) are grouped into a single undo step
  * Edits from the same `Editor` instance within the interval form a transaction group
  * Transactions store the selection state before and after editing
  * Undo/redo restores both text and selections


**Sources:** [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>) [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>) [crates/editor/src/editor_tests.rs210-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor_tests.rs#L210-L318>)

* * *

### Undo and Redo with Selection Restoration

Undo/redo operations restore both text content and cursor positions:


**Selection Restoration Conditions:**

  * Selections are restored if the transaction was created by the same editor
  * Selections are restored if edits occurred within the grouping interval
  * Selections are adjusted (not restored) for edits from other editors or outside the interval
  * The `SelectionHistory` tracks past selection states for the Undo/Redo Selection commands


**Sources:** [crates/editor/src/editor_tests.rs210-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor_tests.rs#L210-L318>) [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>)

* * *

### Autoindent

Autoindent automatically adjusts indentation when inserting newlines or pasting text:


**Modes:**

  * **EachLine** : Each inserted line gets its indentation computed independently
  * **Block** : All lines in an insertion maintain relative indentation, adjusted as a block based on the first line


**Sources:** [crates/language/src/buffer.rs460-482](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs#L460-L482>) [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>)

* * *

### Autoclosing Brackets and Snippets

#### Autoclosing Regions

When typing an opening bracket, the editor automatically inserts the closing bracket and tracks the region:


**Behavior:**

  * When typing the closing bracket, it "jumps over" the auto-inserted one instead of inserting another
  * Autoclosing is invalidated if the cursor leaves the region or text is edited outside
  * Works with brackets, quotes, and language-specific pairs


**Sources:** [crates/editor/src/editor.rs1048](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1048-L1048>) [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>)

* * *

#### Snippet System

Snippets are templates with placeholders that can be navigated with Tab:


**Snippet Features:**

  * Multiple cursors are created at each tabstop for simultaneous editing
  * Typing at one tabstop instance updates all instances of that tabstop
  * Choices present a completion menu with predefined options
  * The snippet state is invalidated if selections move outside expected ranges


**Sources:** [crates/editor/src/editor.rs1049](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1049-L1049>) [crates/snippet/src/lib.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/snippet/src/lib.rs>)

* * *

## Selection Effects and Autoscroll

### Selection Effects System

When selections change, the editor can trigger various effects:


**Effect Types:**

  * **Autoscroll** : Scrolls the view to keep the newest selection visible
  * **Goal preservation** : Maintains horizontal column goal for vertical movement
  * **Immediate scroll** : Scrolls without animation
  * **Deferred effects** : Delays effect application until after a transaction completes


**Sources:** [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>) [crates/editor/src/scroll.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/scroll.rs>)

* * *

## Selection History and Navigation

### SelectionHistory

Tracks selection states for navigation commands:


**Purpose:**

  * Separate from undo/redo of text edits
  * Allows undoing/redoing selection changes independent of text changes
  * Used for commands like "undo selection" and "redo selection"
  * Bounded to prevent unbounded memory growth


**Sources:** [crates/editor/src/editor.rs1045](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L1045-L1045>) [crates/editor/src/editor.rs232](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs#L232-L232>)

* * *

## Summary: Selection and Editing Data Flow


**Key Data Flow:**

  1. User input generates actions (movement, selection, editing)
  2. Actions modify `SelectionsCollection` and trigger edit operations
  3. Edits flow through transactions to the `MultiBuffer` and underlying `Buffer`
  4. Changes are recorded in the undo/redo `History` with associated selection states
  5. Effects like autoscroll and rerendering are triggered
  6. Undo/redo operations restore both text and selections atomically


**Sources:** [crates/editor/src/editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/editor.rs>) [crates/multi_buffer/src/multi_buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/multi_buffer/src/multi_buffer.rs>) [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Selections and Editing Operations](<#selections-and-editing-operations>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [Core Selection Data Structures](<#core-selection-data-structures>)
  * [Selection and Anchor](<#selection-and-anchor>)
  * [SelectionsCollection](<#selectionscollection>)
  * [Mouse-Based Selection](<#mouse-based-selection>)
  * [SelectPhase State Machine](<#selectphase-state-machine>)
  * [Click Count Selection Modes](<#click-count-selection-modes>)
  * [Keyboard-Based Selection](<#keyboard-based-selection>)
  * [Movement with Selection Extension](<#movement-with-selection-extension>)
  * [Multi-Cursor Operations](<#multi-cursor-operations>)
  * [Add Selection Above/Below](<#add-selection-abovebelow>)
  * [Select Next/Previous Occurrence](<#select-nextprevious-occurrence>)
  * [Columnar (Block) Selection](<#columnar-block-selection>)
  * [Editing Operations](<#editing-operations>)
  * [Text Insertion and Deletion](<#text-insertion-and-deletion>)
  * [Transaction System and Grouping](<#transaction-system-and-grouping>)
  * [Undo and Redo with Selection Restoration](<#undo-and-redo-with-selection-restoration>)
  * [Autoindent](<#autoindent>)
  * [Autoclosing Brackets and Snippets](<#autoclosing-brackets-and-snippets>)
  * [Autoclosing Regions](<#autoclosing-regions>)
  * [Snippet System](<#snippet-system>)
  * [Selection Effects and Autoscroll](<#selection-effects-and-autoscroll>)
  * [Selection Effects System](<#selection-effects-system>)
  * [Selection History and Navigation](<#selection-history-and-navigation>)
  * [SelectionHistory](<#selectionhistory>)
  * [Summary: Selection and Editing Data Flow](<#summary-selection-and-editing-data-flow>)
