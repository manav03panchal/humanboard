<!-- Source: https://deepwiki.com/zed-industries/zed/9.2-terminal-view-and-rendering -->

# 9.2 Terminal View And Rendering

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Terminal View and Rendering

Relevant source files

  * [crates/project/src/terminals.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/terminals.rs>)
  * [crates/repl/src/outputs/plain.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/repl/src/outputs/plain.rs>)
  * [crates/task/src/task.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/task/src/task.rs>)
  * [crates/terminal/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/Cargo.toml>)
  * [crates/terminal/src/terminal.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal.rs>)
  * [crates/terminal/src/terminal_hyperlinks.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal_hyperlinks.rs>)
  * [crates/terminal_view/src/persistence.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/persistence.rs>)
  * [crates/terminal_view/src/terminal_element.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs>)
  * [crates/terminal_view/src/terminal_panel.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_panel.rs>)
  * [crates/terminal_view/src/terminal_view.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs>)


## Purpose and Scope

This document covers the UI layer and rendering system for terminal views in Zed. It explains how terminal content is displayed on screen, how user interactions are handled, and how the rendering pipeline processes terminal cells into GPU-accelerated graphics.

For the core terminal functionality including PTY management and Alacritty integration, see [Terminal Core](</zed-industries/zed/9.1-terminal-core>). For task execution and the terminal panel container, see [Task System](</zed-industries/zed/9.3-task-system>).

## Architecture Overview

The terminal view and rendering system consists of two primary components that work together to display terminal content:


**Sources:** [crates/terminal_view/src/terminal_view.rs1-1500](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L1-L1500>) [crates/terminal_view/src/terminal_element.rs1-300](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L1-L300>) [crates/terminal/src/terminal.rs820-850](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal.rs#L820-L850>)

## TerminalView Component

`TerminalView` is the main GPUI component that represents a terminal tab in the workspace. It manages user interaction, focus, and the overall terminal UI state.

### Structure and Key Fields


Key fields in [crates/terminal_view/src/terminal_view.rs117-140](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L117-L140>):

Field| Type| Purpose  
---|---|---  
`terminal`| `Entity<Terminal>`| Reference to the underlying terminal entity  
`focus_handle`| `FocusHandle`| Manages keyboard focus  
`blink_manager`| `Entity<BlinkManager>`| Controls cursor blinking  
`cursor_shape`| `CursorShape`| Current cursor appearance  
`mode`| `TerminalMode`| Standalone or Embedded mode  
`scroll_handle`| `TerminalScrollHandle`| Scrollbar state management  
`hover`| `Option<HoverTarget>`| Current hyperlink hover state  
`block_below_cursor`| `Option<Rc<BlockProperties>>`| Optional UI block (e.g., inline assist)  
`ime_state`| `Option<ImeState>`| Input Method Editor state  
  
**Sources:** [crates/terminal_view/src/terminal_view.rs117-140](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L117-L140>)

### Terminal Modes

TerminalView supports two operational modes defined in [crates/terminal_view/src/terminal_view.rs142-149](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L142-L149>):


The mode determines content display behavior via `content_mode()` in [crates/terminal_view/src/terminal_view.rs296-322](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L296-L322>):

  * **Standalone** : Always scrollable, used for regular terminal tabs
  * **Embedded** : Shows full content inline up to `MAX_EMBEDDED_LINES` (1,000), with optional line limit when unfocused


**Sources:** [crates/terminal_view/src/terminal_view.rs142-322](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L142-L322>)

### Event Subscriptions and Lifecycle

TerminalView subscribes to terminal events through `subscribe_for_terminal_events()` in [crates/terminal_view/src/terminal_view.rs841-937](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L841-L937>):


Key event handlers:

  * `Event::Wakeup`: Triggers UI refresh, tab update, and search invalidation
  * `Event::Bell`: Sets bell indicator on the tab
  * `Event::BlinkChanged`: Updates cursor blinking state
  * `Event::TitleChanged`: Updates tab title/breadcrumbs
  * `Event::NewNavigationTarget`: Updates hyperlink hover tooltip


**Sources:** [crates/terminal_view/src/terminal_view.rs841-937](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L841-L937>)

### IME (Input Method Editor) Support

TerminalView supports complex text input through IME for languages like Chinese, Japanese, and Korean. The implementation is in [crates/terminal_view/src/terminal_view.rs324-360](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L324-L360>):


The IME flow:

  1. **Marked Text Phase** : User types, IME shows composition candidates 
     * `set_marked_text()` stores pre-edit text and selection range
  2. **Commit Phase** : User selects final text 
     * `commit_text()` sends final text to PTY
     * `clear_marked_text()` clears composition state


**Sources:** [crates/terminal_view/src/terminal_view.rs324-360](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L324-L360>)

## TerminalElement and Rendering Pipeline

`TerminalElement` is the GPUI rendering element that converts terminal state into painted pixels. It implements a highly optimized rendering pipeline with text batching and background merging.

### Element Structure


Key fields in [crates/terminal_view/src/terminal_element.rs275-285](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L275-L285>):

  * `terminal`: Reference to terminal entity for reading state
  * `terminal_view`: Reference to view for state updates
  * `focused`: Whether terminal has focus
  * `cursor_visible`: Whether to show cursor
  * `block_below_cursor`: Optional UI element below cursor position
  * `interactivity`: Handles mouse and keyboard events


**Sources:** [crates/terminal_view/src/terminal_element.rs275-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L275-L318>)

### Rendering Pipeline Overview


The rendering process follows these phases:

  1. **Content Reading** : Extract `TerminalContent` from terminal entity
  2. **Layout Phase** : Process cells into optimized structures
  3. **Batching Phase** : Combine adjacent cells with identical styles
  4. **Merging Phase** : Coalesce background regions into minimal rectangles
  5. **Paint Phase** : Render backgrounds, text, cursor, and overlays


**Sources:** [crates/terminal_view/src/terminal_element.rs322-492](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L322-L492>)

### Layout Phase: Grid Processing

The `layout_grid()` function in [crates/terminal_view/src/terminal_element.rs322-492](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L322-L492>) processes terminal cells into renderable structures:


Key optimizations:

  * **Text Batching** : Adjacent cells with identical styling are combined into single text runs
  * **Background Merging** : Contiguous background regions are merged to minimize draw calls
  * **Skip Spacers** : Wide character spacers are skipped during processing


**Sources:** [crates/terminal_view/src/terminal_element.rs322-492](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L322-L492>)

### Text Batching: BatchedTextRun

`BatchedTextRun` combines multiple consecutive cells with identical styling into a single text rendering operation. Defined in [crates/terminal_view/src/terminal_element.rs80-156](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L80-L156>):


Structure:

  * `start_point`: Terminal grid position where this run begins
  * `text`: Accumulated text content
  * `cell_count`: Number of cells this run spans
  * `style`: Font, colors, underline, strikethrough
  * `font_size`: Text size for rendering


Batching logic in [crates/terminal_view/src/terminal_element.rs108-132](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L108-L132>):

  * Cells can batch if font, colors, underline, and strikethrough all match
  * Zero-width characters (e.g., combining diacritics) don't increment cell count
  * Line boundaries force batch breaks


**Sources:** [crates/terminal_view/src/terminal_element.rs80-156](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L80-L156>)

### Background Rendering: LayoutRect and Region Merging

Background colors are rendered as rectangles. The system merges adjacent regions to minimize draw calls.

#### BackgroundRegion and Merging Algorithm

Defined in [crates/terminal_view/src/terminal_element.rs192-271](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L192-L271>):


Merging rules in [crates/terminal_view/src/terminal_element.rs213-238](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L213-L238>):

  * **Horizontal merge** : Same line, same color, adjacent columns
  * **Vertical merge** : Same color, same column span, adjacent lines
  * Iteratively merges until no more merges possible


**LayoutRect** structure in [crates/terminal_view/src/terminal_element.rs158-190](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L158-L190>):

  * Represents single-line rectangular region
  * `point`: Start position (line, column)
  * `num_of_cells`: Width in cells
  * `color`: Background color
  * Multi-line merged regions are split into multiple LayoutRects


**Sources:** [crates/terminal_view/src/terminal_element.rs158-271](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L158-L271>)

### Cursor Rendering

Cursor rendering combines shape calculation with visibility logic. Implementation spans [crates/terminal_view/src/terminal_element.rs496-520](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L496-L520>) and [crates/terminal_view/src/terminal_view.rs634-655](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L634-L655>):


Cursor shape calculation in [crates/terminal_view/src/terminal_element.rs496-520](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L496-L520>):

  * Determines cursor position from display offset
  * Shapes cursor text to get width
  * Falls back to cell width if text width is zero
  * Rounds position down and width up for pixel-perfect coverage


**Sources:** [crates/terminal_view/src/terminal_element.rs496-520](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L496-L520>) [crates/terminal_view/src/terminal_view.rs634-655](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L634-L655>)

### LayoutState Structure

`LayoutState` holds all computed layout information for painting, defined in [crates/terminal_view/src/terminal_element.rs39-55](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L39-L55>):


Key fields:

  * `hitbox`: Mouse interaction bounds
  * `batched_text_runs`: Optimized text rendering data
  * `rects`: Background rectangles
  * `cursor`: Cursor position and appearance
  * `hyperlink_tooltip`: Hover tooltip for links
  * `block_below_cursor_element`: Inline UI element (e.g., assistant)


**Sources:** [crates/terminal_view/src/terminal_element.rs39-55](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L39-L55>)

### Paint Phase

The paint phase executes in [crates/terminal_view/src/terminal_element.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs>) through the GPUI rendering pipeline:


Painting order:

  1. **Background rectangles** : Paint all LayoutRects
  2. **Text runs** : Shape and paint all BatchedTextRuns
  3. **Cursor** : Paint cursor if visible
  4. **Selection** : Paint selection highlights
  5. **Block** : Paint optional block element below cursor


**Sources:** [crates/terminal_view/src/terminal_element.rs322-1100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L322-L1100>)

## Event Handling

### Mouse Event Flow

Mouse events flow through TerminalElement's interactivity system to TerminalView handlers:


Key handlers in TerminalView:

  * **Mouse move** : Hyperlink detection, selection updates, cursor tracking
  * **Mouse down** : Selection start, hyperlink navigation, focus
  * **Mouse up** : Selection end
  * **Right click** : Context menu


**Sources:** [crates/terminal_view/src/terminal_view.rs379-428](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L379-L428>) [crates/terminal/src/terminal.rs1070-1400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal.rs#L1070-L1400>)

### Keyboard Input Processing

Keyboard input follows GPUI's action system and is converted to terminal escape sequences:


Key handling logic in [crates/terminal_view/src/terminal_view.rs464-715](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L464-L715>):

  * Actions like Copy, Paste, Clear intercept specific key combinations
  * Alt screen mode bypasses some special handling
  * Escape sequences are generated in [crates/terminal/src/mappings/keys.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/mappings/keys.rs>)


**Sources:** [crates/terminal_view/src/terminal_view.rs464-715](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L464-L715>) [crates/terminal/src/mappings/keys.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/mappings/keys.rs>)

### Scroll Events

Scrolling is handled through both mouse wheel and action commands:


Scroll handling spans [crates/terminal_view/src/terminal_view.rs529-627](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L529-L627>):

  * **Block scrolling** : When `block_below_cursor` exists and at bottom, scrolls the block region
  * **Line scrolling** : Moves by single line
  * **Page scrolling** : Moves by viewport height
  * **Edge scrolling** : Jumps to top or bottom


The Terminal entity maintains `display_offset` for scrollback buffer navigation.

**Sources:** [crates/terminal_view/src/terminal_view.rs529-627](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L529-L627>) [crates/terminal/src/terminal.rs1042-1220](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal.rs#L1042-L1220>)

## Hyperlink Detection and Rendering

### Detection Pipeline

Hyperlinks are detected through regex matching and semantic analysis:


Detection implementation in [crates/terminal/src/terminal_hyperlinks.rs68-360](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal_hyperlinks.rs#L68-L360>):

  1. **OSC 8 Hyperlinks** : Semantic links embedded in terminal output
  2. **URL Regex** : Matches common URL schemes (http, https, file, etc.)
  3. **Path Regex** : Custom user-defined patterns for file paths
  4. **Sanitization** : Removes trailing punctuation from URLs


**Sources:** [crates/terminal/src/terminal_hyperlinks.rs68-360](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal_hyperlinks.rs#L68-L360>)

### Hover State Management

Hover state is managed in TerminalView with timeout-based updates:


Hover handling in [crates/terminal_view/src/terminal_view.rs895-937](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L895-L937>):

  * Updates stored on `Event::NewNavigationTarget` from Terminal
  * Tooltip displayed via `hyperlink_tooltip` in LayoutState
  * Click triggers navigation via `open_path_like_target()` or URL opening


**Sources:** [crates/terminal_view/src/terminal_view.rs895-937](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L895-L937>) [crates/terminal_view/src/terminal_path_like_target.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_path_like_target.rs>)

### URL Sanitization

The sanitization algorithm removes trailing punctuation that's likely not part of the URL, defined in [crates/terminal/src/terminal_hyperlinks.rs155-204](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal_hyperlinks.rs#L155-L204>):


Examples:

  * `https://example.com.` → `https://example.com`
  * `https://example.com/path),` → `https://example.com/path`
  * `https://en.wikipedia.org/wiki/Example_(disambiguation)` → unchanged (balanced parens)


**Sources:** [crates/terminal/src/terminal_hyperlinks.rs155-204](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal/src/terminal_hyperlinks.rs#L155-L204>)

## Context Menu Integration

The context menu provides quick access to terminal actions:


Implementation in [crates/terminal_view/src/terminal_view.rs379-428](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L379-L428>):

Key features:

  * Position-aware (shows at click location)
  * Assistant integration when enabled
  * Focus management (focus menu, restore on dismiss)
  * Action dispatch through workspace


**Sources:** [crates/terminal_view/src/terminal_view.rs379-428](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L379-L428>)

## Scrollbar Integration

The terminal integrates with GPUI's scrollbar system through `TerminalScrollHandle`:


Implementation in [crates/terminal_view/src/terminal_scrollbar.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_scrollbar.rs>):

  * Tracks display offset (how many lines scrolled up)
  * Calculates scrollbar thumb position and size
  * Updates when terminal scrolls or content changes


**Sources:** [crates/terminal_view/src/terminal_scrollbar.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_scrollbar.rs>)

## Block Below Cursor

The terminal can display an optional UI block below the cursor position, used for features like inline assist:


BlockProperties structure in [crates/terminal_view/src/terminal_view.rs105-109](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L105-L109>):

  * `height`: Number of lines the block occupies
  * `render`: Closure that renders the block content


Usage flow in [crates/terminal_view/src/terminal_view.rs665-680](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L665-L680>):

  1. Feature calls `set_block_below_cursor()` with height and render function
  2. Terminal automatically scrolls to show cursor and block
  3. Custom scroll logic handles scrolling through block content
  4. Feature calls `clear_block_below_cursor()` when done


**Sources:** [crates/terminal_view/src/terminal_view.rs105-680](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L105-L680>)

## Embedded Mode and Content Limits

Embedded mode allows terminals to be displayed inline in other UI contexts (like REPL outputs):


Implementation in [crates/terminal_view/src/terminal_view.rs279-322](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L279-L322>):

Key behaviors:

  * **Unfocused limit** : Optionally limit displayed lines when not focused
  * **Focused** : Show all lines (up to MAX_EMBEDDED_LINES)
  * **Overflow** : Falls back to scrollable mode if too many lines
  * **No scrollbar** : Inline mode doesn't show scrollbar


Example usage in REPL outputs [crates/repl/src/outputs/plain.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/repl/src/outputs/plain.rs>):

  * TerminalOutput wraps Alacritty terminal
  * Renders inline up to configured max
  * Used for stdout, stderr, and error tracebacks


**Sources:** [crates/terminal_view/src/terminal_view.rs279-322](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_view.rs#L279-L322>) [crates/repl/src/outputs/plain.rs117-321](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/repl/src/outputs/plain.rs#L117-L321>)

## Performance Optimizations

### Text Batching

The text batching system significantly reduces rendering overhead:


Benchmarking results (from debug logs in [crates/terminal_view/src/terminal_element.rs482-489](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L482-L489>)):

  * Typical terminal: 1,000+ cells → 50-100 batched runs
  * 90%+ reduction in draw calls
  * Faster layout and paint times


**Sources:** [crates/terminal_view/src/terminal_element.rs322-492](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L322-L492>)

### Background Region Merging

Background merging reduces rectangle count:


Example (from code comments):

  * Selection spanning 10 lines, 80 columns
  * Before: 800 rectangles
  * After horizontal merge: 10 rectangles
  * After vertical merge: 1 rectangle


**Sources:** [crates/terminal_view/src/terminal_element.rs242-271](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L242-L271>)

### Decorative Character Handling

Special handling for block drawing characters preserves visual fidelity [crates/terminal_view/src/terminal_element.rs523-551](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L523-L551>):


Decorative character ranges:

  * Box Drawing: U+2500..U+257F (└ ┐ ─ │)
  * Block Elements: U+2580..U+259F (▀ ▄ █ ░)
  * Geometric Shapes: U+25A0..U+25FF (■ ▶ ●)
  * Powerline separators: U+E0B0..U+E0B7


Rationale: These characters are used for UI borders and separators where exact color matching with backgrounds is critical for visual continuity.

**Sources:** [crates/terminal_view/src/terminal_element.rs523-551](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/terminal_view/src/terminal_element.rs#L523-L551>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Terminal View and Rendering](<#terminal-view-and-rendering>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [Architecture Overview](<#architecture-overview>)
  * [TerminalView Component](<#terminalview-component>)
  * [Structure and Key Fields](<#structure-and-key-fields>)
  * [Terminal Modes](<#terminal-modes>)
  * [Event Subscriptions and Lifecycle](<#event-subscriptions-and-lifecycle>)
  * [IME (Input Method Editor) Support](<#ime-input-method-editor-support>)
  * [TerminalElement and Rendering Pipeline](<#terminalelement-and-rendering-pipeline>)
  * [Element Structure](<#element-structure>)
  * [Rendering Pipeline Overview](<#rendering-pipeline-overview>)
  * [Layout Phase: Grid Processing](<#layout-phase-grid-processing>)
  * [Text Batching: BatchedTextRun](<#text-batching-batchedtextrun>)
  * [Background Rendering: LayoutRect and Region Merging](<#background-rendering-layoutrect-and-region-merging>)
  * [BackgroundRegion and Merging Algorithm](<#backgroundregion-and-merging-algorithm>)
  * [Cursor Rendering](<#cursor-rendering>)
  * [LayoutState Structure](<#layoutstate-structure>)
  * [Paint Phase](<#paint-phase>)
  * [Event Handling](<#event-handling>)
  * [Mouse Event Flow](<#mouse-event-flow>)
  * [Keyboard Input Processing](<#keyboard-input-processing>)
  * [Scroll Events](<#scroll-events>)
  * [Hyperlink Detection and Rendering](<#hyperlink-detection-and-rendering>)
  * [Detection Pipeline](<#detection-pipeline>)
  * [Hover State Management](<#hover-state-management>)
  * [URL Sanitization](<#url-sanitization>)
  * [Context Menu Integration](<#context-menu-integration>)
  * [Scrollbar Integration](<#scrollbar-integration>)
  * [Block Below Cursor](<#block-below-cursor>)
  * [Embedded Mode and Content Limits](<#embedded-mode-and-content-limits>)
  * [Performance Optimizations](<#performance-optimizations>)
  * [Text Batching](<#text-batching>)
  * [Background Region Merging](<#background-region-merging>)
  * [Decorative Character Handling](<#decorative-character-handling>)
