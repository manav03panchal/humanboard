<!-- Source: https://deepwiki.com/zed-industries/zed/2.2-gpui-framework -->

# 2.2 Gpui Framework

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# GPUI Framework

Relevant source files

  * [Cargo.lock](<https://github.com/zed-industries/zed/blob/4109c9dd/Cargo.lock>)
  * [Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/Cargo.toml>)
  * [crates/gpui/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/Cargo.toml>)
  * [crates/gpui/build.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/build.rs>)
  * [crates/gpui/examples/mouse_pressure.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/examples/mouse_pressure.rs>)
  * [crates/gpui/src/app.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs>)
  * [crates/gpui/src/geometry.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/geometry.rs>)
  * [crates/gpui/src/interactive.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/interactive.rs>)
  * [crates/gpui/src/key_dispatch.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/key_dispatch.rs>)
  * [crates/gpui/src/keymap.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/keymap.rs>)
  * [crates/gpui/src/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform.rs>)
  * [crates/gpui/src/platform/linux/headless/client.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/headless/client.rs>)
  * [crates/gpui/src/platform/linux/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/platform.rs>)
  * [crates/gpui/src/platform/linux/wayland/client.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/wayland/client.rs>)
  * [crates/gpui/src/platform/linux/wayland/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/wayland/window.rs>)
  * [crates/gpui/src/platform/linux/x11/client.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/x11/client.rs>)
  * [crates/gpui/src/platform/linux/x11/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/x11/window.rs>)
  * [crates/gpui/src/platform/mac/events.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/events.rs>)
  * [crates/gpui/src/platform/mac/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/platform.rs>)
  * [crates/gpui/src/platform/mac/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/window.rs>)
  * [crates/gpui/src/platform/test/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/test/platform.rs>)
  * [crates/gpui/src/platform/test/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/test/window.rs>)
  * [crates/gpui/src/platform/windows/events.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/events.rs>)
  * [crates/gpui/src/platform/windows/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/platform.rs>)
  * [crates/gpui/src/platform/windows/util.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/util.rs>)
  * [crates/gpui/src/platform/windows/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/window.rs>)
  * [crates/gpui/src/taffy.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/taffy.rs>)
  * [crates/gpui/src/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs>)
  * [crates/ui/src/components/keybinding.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/ui/src/components/keybinding.rs>)
  * [crates/zed/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/zed/Cargo.toml>)
  * [crates/zed/src/main.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/zed/src/main.rs>)
  * [crates/zed/src/zed.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/zed/src/zed.rs>)


## Purpose and Scope

GPUI is Zed's GPU-accelerated UI framework, providing the foundational layer for all user interface rendering, event handling, and window management. This document covers GPUI's core architecture, including the `App` entity, `Window` management, the element composition system, platform abstractions, and the rendering pipeline.

For information about specific UI components built on GPUI, see [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>). For text editing specifically, see [Editor Architecture](</zed-industries/zed/3-editor-architecture>).

* * *

## System Overview

GPUI operates as an immediate-mode UI framework with GPU-accelerated rendering. Unlike retained-mode frameworks, GPUI rebuilds the UI tree on each frame, achieving high performance through efficient diffing and GPU utilization.

### Core Architecture


**Sources:** [crates/gpui/src/app.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs>) [crates/gpui/src/window.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs>) [crates/gpui/src/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform.rs>) [crates/gpui/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/Cargo.toml>)

* * *

## Application Entity (App)

The `App` struct is the central coordinator for all GPUI operations. It manages global state, entity storage, window lifecycle, and executes the main event loop.

### App Responsibilities

Responsibility| Implementation| File Location  
---|---|---  
Entity Management| `EntityMap` with slotmap storage| [crates/gpui/src/app/entity_map.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app/entity_map.rs>)  
Window Registry| `SlotMap<WindowId, Window>`| [crates/gpui/src/app.rs500-600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L500-L600>)  
Effect Queue| `VecDeque<Effect>` for deferred operations| [crates/gpui/src/app.rs700-800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L700-L800>)  
Global State| Type-indexed storage via `FxHashMap<TypeId, Box<dyn Any>>`| [crates/gpui/src/app.rs300-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L300-L400>)  
Executor Management| `BackgroundExecutor` and `ForegroundExecutor`| [crates/gpui/src/app.rs200-250](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L200-L250>)  
  
### Application Lifecycle


**Sources:** [crates/gpui/src/app.rs126-160](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L126-L160>) [crates/zed/src/main.rs408-500](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/zed/src/main.rs#L408-L500>)

### App Initialization

The `Application` struct provides builder-style initialization:


The `run()` method enters the platform's main event loop. On macOS, this delegates to `NSApplication`. On Windows, it uses the Win32 message loop. On Linux, it uses either X11 or Wayland event loops via `calloop`.

**Sources:** [crates/gpui/src/app.rs126-160](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L126-L160>) [crates/zed/src/main.rs290-350](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/zed/src/main.rs#L290-L350>) [crates/gpui/src/platform/mac/platform.rs100-200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/platform.rs#L100-L200>) [crates/gpui/src/platform/windows/platform.rs95-175](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/platform.rs#L95-L175>)

* * *

## Window Management

Each `Window` represents a single OS window with its own rendering context, event dispatch tree, and focus state.

### Window Structure


**Sources:** [crates/gpui/src/window.rs1-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L1-L100>) [crates/gpui/src/window.rs800-900](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L800-L900>)

### Window Creation

Windows are created through `App::open_window()` or `AsyncApp::open_window()`:


Window creation flow:

  1. `App::open_window()` generates a `WindowId`
  2. Platform layer creates native window (`NSWindow`, `HWND`, etc.)
  3. GPU renderer initialized for window surface
  4. Root view rendered to generate initial frame
  5. Window added to app's window registry


**Sources:** [crates/gpui/src/app.rs1500-1600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L1500-L1600>) [crates/gpui/src/platform/mac/window.rs300-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/window.rs#L300-L400>) [crates/gpui/src/platform/windows/window.rs88-156](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/window.rs#L88-L156>)

### Draw Phases

Each window frame progresses through distinct draw phases:

Phase| Purpose| Key Operations  
---|---|---  
`None`| Window idle| Waiting for invalidation  
`Prepaint`| Layout calculation| Compute element sizes & positions via Taffy  
`Paint`| Scene generation| Build draw commands, populate hitboxes  
`Rendered`| GPU submission| Submit scene to Blade renderer  
  
**Sources:** [crates/gpui/src/window.rs100-200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L100-L200>) [crates/gpui/src/window.rs3000-3100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L3000-L3100>)

* * *

## Platform Abstraction

GPUI abstracts platform differences through the `Platform` trait, with implementations for macOS, Windows, and Linux (X11 & Wayland).

### Platform Trait Interface


**Sources:** [crates/gpui/src/platform.rs400-600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform.rs#L400-L600>)

### Platform-Specific Implementations

#### macOS Platform

  * **Implementation** : `MacPlatform` uses Cocoa/AppKit APIs
  * **Window Class** : `MacWindow` wraps `NSWindow`
  * **Rendering** : Metal via Blade or native CoreAnimation
  * **Text** : CoreText for glyph shaping
  * **Event Loop** : `NSApplication` run loop


**Sources:** [crates/gpui/src/platform/mac/platform.rs1-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/platform.rs#L1-L100>) [crates/gpui/src/platform/mac/window.rs1-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/window.rs#L1-L50>)

#### Windows Platform

  * **Implementation** : `WindowsPlatform` uses Win32 APIs
  * **Window Class** : `WindowsWindow` wraps `HWND`
  * **Rendering** : DirectX 11 via Blade or DirectComposition
  * **Text** : DirectWrite for text layout
  * **Event Loop** : `GetMessage`/`DispatchMessage` loop


**Sources:** [crates/gpui/src/platform/windows/platform.rs31-47](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/platform.rs#L31-L47>) [crates/gpui/src/platform/windows/window.rs31-86](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/window.rs#L31-L86>)

#### Linux Platform

GPUI supports both X11 and Wayland on Linux:

**X11 Implementation** :

  * **Client** : `X11Client` using `x11rb` library
  * **Window** : `X11Window` with XCB connection
  * **Rendering** : Vulkan via Blade
  * **Input** : XInput2 for input events, XKB for keyboard
  * **Event Loop** : `calloop` with X11 connection file descriptor


**Wayland Implementation** :

  * **Client** : `WaylandClient` using `wayland-client`
  * **Window** : `WaylandWindow` with wl_surface
  * **Protocols** : XDG Shell, fractional scaling, decorations
  * **Rendering** : Vulkan via Blade
  * **Event Loop** : `calloop` with Wayland connection


**Sources:** [crates/gpui/src/platform/linux/x11/client.rs1-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/x11/client.rs#L1-L100>) [crates/gpui/src/platform/linux/wayland/client.rs1-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/wayland/client.rs#L1-L100>) [crates/gpui/src/platform.rs96-124](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform.rs#L96-L124>)

* * *

## Rendering Pipeline

GPUI uses GPU-accelerated rendering through the Blade graphics abstraction layer, which provides a unified interface over Metal, DirectX, and Vulkan.

### Rendering Architecture


**Sources:** [crates/gpui/src/window.rs6000-6100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L6000-L6100>) [crates/gpui/src/platform/blade/renderer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/blade/renderer.rs>) [crates/gpui/src/platform/windows/renderer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/renderer.rs>)

### Scene Construction

A `Scene` accumulates draw commands during the paint phase:


**Scene Structure** :

  * **Layers** : Separated layers for depth ordering (indexed by `LayerId`)
  * **Shadows** : Pre-computed box-shadow quads
  * **Quads** : Rectangular primitives with borders and corner radii
  * **Monochrome Paths** : Single-color vector shapes
  * **Polychrome Paths** : Multi-color vector shapes
  * **Underlines** : Text decoration primitives
  * **Glyphs** : Positioned text glyph instances
  * **Images** : Textured quads from image sources
  * **Surfaces** : Embedded window content


**Sources:** [crates/gpui/src/scene.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/scene.rs>) [crates/gpui/src/window.rs6000-6100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L6000-L6100>)

### GPU Rendering (Blade)

On macOS and Linux, GPUI uses Blade for GPU acceleration:

  1. **Atlas Management** : Glyphs and small images cached in texture atlases using `etagere` for efficient packing
  2. **Batch Rendering** : Similar draw commands batched to minimize draw calls
  3. **Shader Pipeline** : Specialized shaders for quads, shadows, text, paths
  4. **Command Encoding** : Metal/Vulkan command buffers encoded per frame
  5. **VSync** : Display link synchronization for smooth 60fps rendering


**Sources:** [crates/gpui/src/platform/blade/renderer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/blade/renderer.rs>) [crates/gpui/src/platform/blade/atlas.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/blade/atlas.rs>)

### Text Rendering

Text rendering uses platform-specific text shaping:

**macOS** : CoreText for text layout and shaping **Windows** : DirectWrite for text shaping and layout  
**Linux** : FontConfig + FreeType via `font-kit`, HarfBuzz for shaping via `cosmic-text`

Glyphs are rasterized and cached in GPU texture atlases. The `TextSystem` trait abstracts these platform differences.

**Sources:** [crates/gpui/src/text_system.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/text_system.rs>) [crates/gpui/src/platform/mac/text_system.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/text_system.rs>) [crates/gpui/src/platform/windows/text_system.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/text_system.rs>)

* * *

## Element System

GPUI uses an immediate-mode element composition system. Elements are ephemeral objects created each frame to describe the UI hierarchy.

### Element Trait


**Sources:** [crates/gpui/src/element.rs100-200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/element.rs#L100-L200>)

### Element Lifecycle


**Sources:** [crates/gpui/src/window.rs3000-3200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L3000-L3200>) [crates/gpui/src/element.rs100-200](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/element.rs#L100-L200>)

### Layout Engine (Taffy)

GPUI uses [Taffy](<https://github.com/zed-industries/zed/blob/4109c9dd/Taffy>) for layout calculation, implementing CSS Flexbox and Grid layout algorithms:

  * **Style to Taffy Conversion** : GPUI's `Style` converted to Taffy's layout style
  * **Constraint Solving** : Taffy computes element sizes and positions
  * **Cached Layout IDs** : `LayoutId` references computed layout nodes
  * **Incremental Layout** : Only recomputes layout for changed subtrees


**Sources:** [crates/gpui/src/taffy.rs1-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/taffy.rs#L1-L50>) [Cargo.toml132](<https://github.com/zed-industries/zed/blob/4109c9dd/Cargo.toml#L132-L132>)

### View System

Views are stateful components that implement the `Render` trait:


When a view needs to update:

  1. Call `cx.notify()` to mark the view dirty
  2. Window invalidates and schedules redraw
  3. Next frame calls `render()` to produce new element tree
  4. Element tree laid out and painted


**Sources:** [crates/gpui/src/element.rs50-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/element.rs#L50-L100>) [crates/gpui/src/window.rs4000-4100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L4000-L4100>)

* * *

## Event Handling and Input

GPUI implements a two-phase event dispatch system (capture and bubble) similar to web browsers.

### Event Flow


**Sources:** [crates/gpui/src/window.rs70-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L70-L100>) [crates/gpui/src/window/dispatch_tree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window/dispatch_tree.rs>)

### Input Processing

Platform-specific input handling translates native events to GPUI's input types:

**Mouse Events** :

  * `MouseDownEvent`, `MouseUpEvent`: Button press/release
  * `MouseMoveEvent`: Cursor movement with modifiers
  * `ScrollWheelEvent`: Mouse wheel with delta and phase


**Keyboard Events** :

  * `KeyDownEvent`: Key press with keystroke and modifiers
  * `KeyUpEvent`: Key release
  * `ModifiersChangedEvent`: Modifier key state changes


**Touch Events** (partial support on some platforms):

  * Touch down, move, up with touch phase tracking


**Sources:** [crates/gpui/src/platform.rs250-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform.rs#L250-L400>) [crates/gpui/src/platform/windows/events.rs35-116](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/events.rs#L35-L116>) [crates/gpui/src/platform/mac/events.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/events.rs>)

### Keystroke Translation

Each platform translates native key codes to GPUI `Keystroke` objects:

**macOS** : Uses `UCKeyTranslate` API for keyboard layout-aware translation **Windows** : Uses `MapVirtualKey` and keyboard layout APIs **Linux** : Uses XKB (X Keyboard Extension) for both X11 and Wayland

The `PlatformKeyboardMapper` trait abstracts this:


**Sources:** [crates/gpui/src/platform/keyboard.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/keyboard.rs>) [crates/gpui/src/platform/mac/platform.rs200-300](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/platform.rs#L200-L300>) [crates/gpui/src/platform/windows/platform.rs400-500](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/platform.rs#L400-L500>)

### Action Dispatch

Actions are dispatched through the `DispatchTree`:

  1. Platform event triggers keystroke detection
  2. `Keymap` matches keystroke sequence to bound action
  3. `DispatchTree` routes action through focused element path
  4. Elements handle action via registered listeners
  5. Event propagation stops if action handled


**Sources:** [crates/gpui/src/key_dispatch.rs1-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/key_dispatch.rs#L1-L50>) [crates/gpui/src/keymap.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/keymap.rs>) [crates/gpui/src/window/dispatch_tree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window/dispatch_tree.rs>)

* * *

## Focus Management

GPUI provides a focus management system for keyboard navigation and input handling.

### Focus System


**Sources:** [crates/gpui/src/window.rs213-283](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L213-L283>) [crates/gpui/src/window.rs236-242](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L236-L242>)

### Focus Operations

**Creating Focus Handles** :


**Focusing Elements** :


**Checking Focus State** :


**Tab Navigation** : GPUI automatically handles tab navigation based on `tab_index` and `tab_stop` properties. Elements with `tab_stop: true` participate in tab order.

**Sources:** [crates/gpui/src/window.rs274-384](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L274-L384>) [crates/gpui/src/window.rs319-337](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L319-L337>)

* * *

## Reactive Updates

GPUI provides reactive primitives for updating UI when data changes.

### Entity Observation

Entities can be observed for changes:


**Sources:** [crates/gpui/src/app/context.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app/context.rs>)

### Window Invalidation

Windows track dirty state and repaint only when needed:


The `WindowInvalidator` tracks:

  * `dirty: bool` \- Whether window needs repaint
  * `dirty_views: FxHashSet<EntityId>` \- Specific views to re-render
  * `draw_phase: DrawPhase` \- Current rendering phase


**Sources:** [crates/gpui/src/window.rs102-186](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L102-L186>) [crates/gpui/src/window.rs124-134](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L124-L134>)

### Effect Queue

The app maintains an effect queue for deferred operations:


Effects are flushed after event handlers complete, ensuring consistent state updates.

**Sources:** [crates/gpui/src/app.rs700-800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app.rs#L700-L800>)

* * *

## Cross-Platform Considerations

### DPI Scaling

GPUI handles high-DPI displays through scale factors:

  * **Scale Factor** : Ratio of physical pixels to logical pixels (e.g., 2.0 for Retina displays)
  * **Pixel Types** : `Pixels` (logical), `DevicePixels` (physical), `ScaledPixels` (scaled)
  * **Conversion** : Automatic conversion via `.scale(factor)` and `.to_pixels(factor)`


**Sources:** [crates/gpui/src/geometry.rs500-700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/geometry.rs#L500-L700>) [crates/gpui/src/window.rs40-60](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L40-L60>)

### Window Decorations

GPUI supports both client-side and server-side window decorations:

  * **Server Decorations** : Platform draws title bar (Windows default, X11 WM)
  * **Client Decorations** : GPUI draws custom title bar (macOS, Wayland default)


Controlled via `WindowDecorations::Client` or `WindowDecorations::Server`.

**Sources:** [crates/gpui/src/window.rs25-40](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L25-L40>) [crates/zed/src/zed.rs313-317](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/zed/src/zed.rs#L313-L317>)

### Clipboard Integration

Platform-specific clipboard implementations:

**macOS** : `NSPasteboard` for clipboard and drag-and-drop **Windows** : Win32 clipboard APIs (`OpenClipboard`, `SetClipboardData`) **Linux** : X11 selections (PRIMARY, CLIPBOARD) or Wayland data device

All abstracted through `ClipboardItem` interface.

**Sources:** [crates/gpui/src/platform/mac/platform.rs500-600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/mac/platform.rs#L500-L600>) [crates/gpui/src/platform/windows/platform.rs300-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/windows/platform.rs#L300-L400>) [crates/gpui/src/platform/linux/clipboard.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/linux/clipboard.rs>)

* * *

## Performance Characteristics

### Frame Budget

GPUI targets 60 FPS (16.67ms per frame):

  * **Layout** : ~2-4ms for typical frames (Taffy flexbox calculations)
  * **Paint** : ~1-2ms building scene commands
  * **GPU Submit** : ~1-2ms encoding and submitting to GPU
  * **VSync Wait** : Remaining time until next display refresh


**Sources:** [crates/gpui/src/window.rs3000-3100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L3000-L3100>)

### Optimization Strategies

  1. **Arena Allocation** : Element trees allocated in bump arena, cleared each frame
  2. **Atlas Caching** : Glyphs and images cached in GPU texture atlases
  3. **Batch Rendering** : Similar primitives batched to minimize draw calls
  4. **Incremental Layout** : Taffy only recomputes changed layout subtrees
  5. **Dirty Tracking** : Only repaint windows with actual changes


**Sources:** [crates/gpui/src/window.rs219-234](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L219-L234>) [crates/gpui/src/platform/blade/atlas.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/blade/atlas.rs>)

### Memory Management

  * **Entity Storage** : Generational indices prevent use-after-free
  * **Reference Counting** : Shared resources (`Arc`, `Rc`) for expensive objects
  * **Weak References** : Prevent reference cycles in observers
  * **Arena Clearing** : Per-frame arena reset avoids fragmentation


**Sources:** [crates/gpui/src/app/entity_map.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app/entity_map.rs>) [crates/gpui/src/window.rs219-234](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/window.rs#L219-L234>)

* * *

## Testing Support

GPUI provides a test platform for headless testing:


**Test Features** :

  * Headless mode (no actual windows)
  * Deterministic executor for async testing
  * Simulated input events
  * Direct entity access


**Sources:** [crates/gpui/src/app/test_context.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/app/test_context.rs>) [crates/gpui/src/platform/test/platform.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/gpui/src/platform/test/platform.rs>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [GPUI Framework](<#gpui-framework>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [System Overview](<#system-overview>)
  * [Core Architecture](<#core-architecture>)
  * [Application Entity (App)](<#application-entity-app>)
  * [App Responsibilities](<#app-responsibilities>)
  * [Application Lifecycle](<#application-lifecycle>)
  * [App Initialization](<#app-initialization>)
  * [Window Management](<#window-management>)
  * [Window Structure](<#window-structure>)
  * [Window Creation](<#window-creation>)
  * [Draw Phases](<#draw-phases>)
  * [Platform Abstraction](<#platform-abstraction>)
  * [Platform Trait Interface](<#platform-trait-interface>)
  * [Platform-Specific Implementations](<#platform-specific-implementations>)
  * [macOS Platform](<#macos-platform>)
  * [Windows Platform](<#windows-platform>)
  * [Linux Platform](<#linux-platform>)
  * [Rendering Pipeline](<#rendering-pipeline>)
  * [Rendering Architecture](<#rendering-architecture>)
  * [Scene Construction](<#scene-construction>)
  * [GPU Rendering (Blade)](<#gpu-rendering-blade>)
  * [Text Rendering](<#text-rendering>)
  * [Element System](<#element-system>)
  * [Element Trait](<#element-trait>)
  * [Element Lifecycle](<#element-lifecycle>)
  * [Layout Engine (Taffy)](<#layout-engine-taffy>)
  * [View System](<#view-system>)
  * [Event Handling and Input](<#event-handling-and-input>)
  * [Event Flow](<#event-flow>)
  * [Input Processing](<#input-processing>)
  * [Keystroke Translation](<#keystroke-translation>)
  * [Action Dispatch](<#action-dispatch>)
  * [Focus Management](<#focus-management>)
  * [Focus System](<#focus-system>)
  * [Focus Operations](<#focus-operations>)
  * [Reactive Updates](<#reactive-updates>)
  * [Entity Observation](<#entity-observation>)
  * [Window Invalidation](<#window-invalidation>)
  * [Effect Queue](<#effect-queue>)
  * [Cross-Platform Considerations](<#cross-platform-considerations>)
  * [DPI Scaling](<#dpi-scaling>)
  * [Window Decorations](<#window-decorations>)
  * [Clipboard Integration](<#clipboard-integration>)
  * [Performance Characteristics](<#performance-characteristics>)
  * [Frame Budget](<#frame-budget>)
  * [Optimization Strategies](<#optimization-strategies>)
  * [Memory Management](<#memory-management>)
  * [Testing Support](<#testing-support>)
