<!-- Source: https://deepwiki.com/zed-industries/zed/5.2-worktree-and-file-system -->

# 5.2 Worktree And File System

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Worktree and File System

Relevant source files

  * [crates/collab/src/tests/editor_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/editor_tests.rs>)
  * [crates/collab/src/tests/integration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/integration_tests.rs>)
  * [crates/collab/src/tests/remote_editing_collaboration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/remote_editing_collaboration_tests.rs>)
  * [crates/copilot/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/Cargo.toml>)
  * [crates/copilot/src/copilot.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/copilot.rs>)
  * [crates/copilot/src/sign_in.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/sign_in.rs>)
  * [crates/editor/src/hover_links.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/hover_links.rs>)
  * [crates/fs/src/fs.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fs.rs>)
  * [crates/git/src/status.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/status.rs>)
  * [crates/lsp/src/lsp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/lsp/src/lsp.rs>)
  * [crates/prettier/src/prettier.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier.rs>)
  * [crates/prettier/src/prettier_server.js](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier_server.js>)
  * [crates/project/src/buffer_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs>)
  * [crates/project/src/lsp_command.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs>)
  * [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>)
  * [crates/project/src/prettier_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/prettier_store.rs>)
  * [crates/project/src/project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs>)
  * [crates/project/src/project_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project_tests.rs>)
  * [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>)
  * [crates/proto/proto/lsp.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto>)
  * [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)
  * [crates/remote_server/src/remote_editing_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/remote_editing_tests.rs>)
  * [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>)
  * [crates/worktree/src/worktree_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs>)


## Purpose and Scope

This page documents the worktree and file system subsystem in Zed, which is responsible for tracking and monitoring files and directories within a project. A worktree represents a directory tree (or single file) that has been opened in Zed, maintaining an indexed view of all entries, monitoring file system changes, and integrating with git repositories.

For information about how the Project coordinates multiple worktrees and other services, see [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>). For details about how open buffers are managed, see [Buffer Store](</zed-industries/zed/5.3-buffer-store>).

## Worktree Architecture

The worktree system provides a semantics-aware view of the file system, tracking entries, git state, and file metadata. Each worktree corresponds to either a directory or a single file opened in Zed.

**Worktree Variants and Core Responsibilities**


Sources: [crates/worktree/src/worktree.rs87-90](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L87-L90>) [crates/worktree/src/worktree.rs162-184](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L162-L184>) [crates/worktree/src/worktree.rs232-246](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L232-L246>)

The `Worktree` enum [crates/worktree/src/worktree.rs87-90](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L87-L90>) has two variants:

  * **`LocalWorktree`** : Manages a directory tree with direct file system access, including scanning, monitoring, and git repository tracking
  * **`RemoteWorktree`** : Represents a worktree on a remote machine (via SSH or collaboration), communicating through RPC


Both variants share a common `Snapshot` structure that provides an immutable, indexed view of the directory tree at a point in time.

## Entry System

Entries represent files and directories tracked by the worktree. Each entry is identified by a `ProjectEntryId` and maintains metadata about the file or directory.

**Entry Structure and Tracking**

Field| Type| Purpose  
---|---|---  
`id`| `ProjectEntryId`| Unique identifier across all worktrees  
`kind`| `EntryKind`| File, Dir, or UnloadedDir  
`path`| `Arc<RelPath>`| Path relative to worktree root  
`inode`| `u64`| File system inode number  
`mtime`| `MTime`| Modification time  
`is_ignored`| `bool`| Whether ignored by .gitignore  
`is_external`| `bool`| Whether outside worktree root (symlink)  
`git_status`| `Option<GitFileStatus>`| Git status if tracked  
  
Sources: [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) (Entry struct definition)

Entries are stored in two `SumTree` structures within each `Snapshot`:

  * **`entries_by_path`** : Allows efficient lookup and traversal by path
  * **`entries_by_id`** : Allows efficient lookup by `ProjectEntryId`


The `EntryKind` enum [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) distinguishes between:

  * **`File`** : A regular file
  * **`Dir`** : A fully scanned directory
  * **`UnloadedDir`** : A directory that exists but hasn't been scanned yet (e.g., external symlinks)


## Snapshot System

Snapshots provide an immutable, consistent view of the worktree state. All queries against a worktree operate on a snapshot, ensuring consistency even as the background scanner updates the tree.

**Snapshot Architecture**


Sources: [crates/worktree/src/worktree.rs162-184](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L162-L184>) [crates/worktree/src/worktree.rs232-246](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L232-L246>)

**Scan ID Tracking** : The `scan_id` field [crates/worktree/src/worktree.rs177](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L177-L177>) increments each time the worktree begins scanning a set of paths, while `completed_scan_id` [crates/worktree/src/worktree.rs183](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L183-L183>) tracks the latest scan that has fully completed. This allows clients to wait for specific scans to finish and distinguish between in-progress and completed scans.

**LocalSnapshot Extensions** : For local worktrees, the `LocalSnapshot` [crates/worktree/src/worktree.rs232-246](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L232-L246>) extends the base `Snapshot` with:

  * **`ignores_by_parent_abs_path`** : Cached gitignore files indexed by directory
  * **`git_repositories`** : Tracked git repositories with their work directories
  * **`root_file_handle`** : File handle for the worktree root (used to detect moves)
  * **`executor`** : Background executor for async operations


## File System Monitoring and Scanning

Local worktrees actively monitor the file system for changes and maintain an up-to-date view through continuous scanning.

**Scanning and Update Flow**


Sources: [crates/worktree/src/worktree.rs121-135](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L121-L135>) [crates/worktree/src/worktree.rs248-260](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L248-L260>)

**Scanning Process** : The background scanner [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) maintains a `BackgroundScannerState` [crates/worktree/src/worktree.rs248-260](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L248-L260>) that tracks:

  * **`paths_to_scan`** : Paths that need scanning due to FS events or explicit requests
  * **`path_prefixes_to_scan`** : Directory prefixes to scan (for external dirs)
  * **`removed_entries`** : Recently removed entries (inode tracked for potential reuse)
  * **`changed_paths`** : Paths that changed during the current scan


**File System Watcher** : Local worktrees create a file system watcher [crates/fs/src/fs.rs137-144](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fs.rs#L137-L144>) that monitors for changes. On macOS, this uses FSEvents [crates/fs/src/mac_watcher.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/mac_watcher.rs>); on other platforms, it uses a cross-platform watcher [crates/fs/src/fs_watcher.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fs_watcher.rs>)

**Debouncing** : File system events are debounced with `FS_WATCH_LATENCY` (100ms) [crates/worktree/src/worktree.rs74](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L74-L74>) to batch rapid changes and reduce scanning overhead.

**Scan Requests** : In addition to file system events, worktrees accept explicit scan requests via:

  * **`scan_requests_tx`** : For scanning specific relative paths [crates/worktree/src/worktree.rs123](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L123-L123>)
  * **`path_prefixes_to_scan_tx`** : For scanning directory prefixes (used for external directories) [crates/worktree/src/worktree.rs124](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L124-L124>)


## Local vs Remote Worktrees

Zed's architecture supports both local and remote worktrees, enabling seamless development on remote machines via SSH or in collaborative sessions.

**Local and Remote Worktree Architecture**


Sources: [crates/worktree/src/worktree.rs121-135](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L121-L135>) [crates/worktree/src/worktree.rs147-159](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L147-L159>) [crates/remote_server/src/headless_project.rs45-63](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L45-L63>)

**LocalWorktree** [crates/worktree/src/worktree.rs121-135](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L121-L135>):

  * Maintains direct `Arc<dyn Fs>` reference for file operations
  * Runs background scanner tasks that monitor file system changes
  * Manages file system watcher for change notifications
  * Tracks `next_entry_id` counter for assigning entry IDs
  * Optionally shares updates with remote clients via `update_observer`


**RemoteWorktree** [crates/worktree/src/worktree.rs147-159](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L147-L159>):

  * Maintains `AnyProtoClient` for RPC communication with server
  * Stores `project_id` to identify the remote project
  * Uses `background_snapshot` with background task to apply updates asynchronously
  * Queues `proto::UpdateWorktree` messages and applies them to snapshot
  * Tracks `file_scan_inclusions` to filter which files are synchronized


**Update Propagation** : When a `LocalWorktree` on the server detects changes, it sends `proto::UpdateWorktree` messages [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) containing:

  * Updated entries with their metadata
  * Removed entry IDs
  * Updated git repositories
  * Scan ID information


The client's `RemoteWorktree` receives these messages, applies them to its background snapshot in a background task, then synchronizes the foreground snapshot on the main thread [crates/worktree/src/worktree.rs521-571](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L521-L571>)

## WorktreeStore

The `WorktreeStore` manages all worktrees within a project and coordinates their lifecycle.

**WorktreeStore Architecture**


Sources: [crates/project/src/worktree_store.rs54-65](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs#L54-L65>) [crates/project/src/worktree_store.rs43-52](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs#L43-L52>)

**Key Responsibilities** :

  1. **Worktree Lifecycle** : Creates and manages worktrees via `find_or_create_worktree()` [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>) which:

     * Checks if a worktree already exists for the path
     * Reuses existing loading tasks to avoid duplicate operations
     * Creates new `LocalWorktree` or requests remote worktrees via RPC
  2. **Entry ID Allocation** : Maintains shared `next_entry_id` counter [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>) that ensures unique `ProjectEntryId` values across all worktrees in the project.

  3. **Worktree Ordering** : Tracks `worktrees_reordered` flag [crates/project/src/worktree_store.rs59](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs#L59-L59>) and emits `WorktreeOrderChanged` events when worktrees are reordered in the UI.

  4. **RPC Coordination** : For remote projects, the store communicates with the server via `upstream_client` to request worktree creation, updates, and operations.


**WorktreeHandle** : Each worktree in the store is wrapped in a `WorktreeHandle` [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>) that provides:

  * Strong reference to the `Entity<Worktree>`
  * Metadata about visibility and sort order
  * Event subscription management


## Git Integration

Worktrees integrate with git repositories to track file status, detect repositories, and monitor git state changes.

**Git Repository Tracking**


Sources: [crates/worktree/src/worktree.rs191-230](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L191-L230>) [crates/worktree/src/worktree.rs263-285](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L263-L285>)

**WorkDirectory** [crates/worktree/src/worktree.rs191-230](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L191-L230>): Represents the "content path" of a repository:

  * **`InProject`** : The .git folder is within the worktree (normal case)
  * **`AboveProject`** : The .git folder is in a parent directory (worktree is a subdirectory of a git repo)


**LocalRepositoryEntry** [crates/worktree/src/worktree.rs263-285](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L263-L285>) tracks:

  * **`work_directory_id`** : Entry ID of the work directory
  * **`dot_git_abs_path`** : Absolute path to the .git entry (may be a file for submodules/worktrees)
  * **`common_dir_abs_path`** : Path to the common directory (parent .git for submodules)
  * **`repository_dir_abs_path`** : Path holding the repository state
  * **`git_dir_scan_id`** : Scan ID when this repository was detected


**Repository Detection** : During scanning, when a `.git` directory or gitfile is encountered, the scanner:

  1. Determines the actual git directory path (following gitfiles for submodules)
  2. Identifies the work directory relative to the worktree root
  3. Creates a `LocalRepositoryEntry` and adds it to the snapshot
  4. The `GitStore` uses this information to create `GitRepository` instances


**Git Status Integration** : Each `Entry` can have a `git_status` field containing the file's git status. The `GitStore` (see page [Git Store](</zed-industries/zed/8.2-git-store-and-state-management>)) queries git and updates entry statuses, which are reflected in the worktree snapshot.

## Special Features

### Symlink Handling

Worktrees track and handle symbolic links, distinguishing between internal symlinks (within the worktree) and external symlinks (pointing outside).

**Symlink Architecture**


Sources: [crates/worktree/src/worktree_tests.rs83-164](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs#L83-L164>) [crates/worktree/src/worktree_tests.rs167-342](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs#L167-L342>)

**Internal vs External Symlinks** :

  * **Internal** : Symlink target is within the worktree root → scanned automatically
  * **External** : Symlink target is outside the worktree root → marked as `UnloadedDir`, requires explicit expansion


**Circular Symlink Prevention** : The scanner detects circular symlinks by tracking visited paths and inodes [crates/worktree/src/worktree_tests.rs83-164](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs#L83-L164>) When a circular reference is detected, the symlink is still tracked but not recursively followed.

**External Directory Expansion** : External directories are initially marked as `EntryKind::UnloadedDir` and set as `is_external: true`. To load their contents:

  1. Client calls `refresh_entries_for_paths()` with the external directory path
  2. Scanner explicitly scans the external directory's contents
  3. Subdirectories within the external directory are also marked external
  4. Changes are propagated as `PathChange::Loaded` events


### Gitignore and File Filtering

Worktrees respect `.gitignore` files and provide filtering mechanisms for file visibility.

**Gitignore Architecture**


Sources: [crates/worktree/src/worktree.rs232-246](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L232-L246>) [crates/worktree/src/worktree_settings.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_settings.rs>)

**Gitignore Processing** :

  * **Global gitignore** : Loaded from `~/.gitignore_global` or system config
  * **Per-directory gitignores** : Cached in `ignores_by_parent_abs_path` by directory
  * The boolean flag indicates whether the gitignore needs updating


**Entry Filtering Flags** :

  * **`is_ignored`** : File matches `.gitignore` rules
  * **`is_private`** : File matches `WorktreeSettings.private_files` patterns (e.g., `.env`)
  * **`is_hidden`** : File matches `WorktreeSettings.file_scan_exclusions` patterns


**Visibility Control** : The `entries()` method [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) accepts an `include_ignored` parameter:

  * `false`: Returns only non-ignored entries (default view)
  * `true`: Returns all entries including ignored ones


### File Operations

Worktrees support various file operations that interact with the file system and update the snapshot.

**Supported Operations** :

Operation| Method| Description  
---|---|---  
Load file| `load_file()`| Read file contents as text  
Load binary| `load_binary_file()`| Read file contents as bytes  
Save file| `write_file()`| Write text to file with line endings  
Create entry| `create_entry()`| Create new file or directory  
Rename entry| `rename_entry()`| Move/rename file or directory  
Delete entry| `delete_entry()`| Remove file or directory  
Copy entry| `copy_entry()`| Copy file or directory  
  
Sources: [crates/worktree/src/worktree.rs710-745](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L710-L745>)

All file operations are performed on `LocalWorktree` only [crates/worktree/src/worktree.rs710-745](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L710-L745>) For `RemoteWorktree`, operations are sent as RPC requests to the server where the actual `LocalWorktree` performs them.

**File Operation Flow** :

  1. Operation requested on `LocalWorktree`
  2. File system operation performed via `Arc<dyn Fs>`
  3. Request explicit scan of affected paths
  4. Scanner detects changes and updates snapshot
  5. `UpdatedEntriesSet` event emitted to observers
  6. For remote worktrees, updates sent via RPC to clients


**CreatedEntry Result** : The `create_entry()` operation [crates/worktree/src/worktree.rs93-99](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L93-L99>) returns a `CreatedEntry` enum:

  * **`Included(Entry)`** : Entry was created and indexed
  * **`Excluded { abs_path }`** : Entry was created but excluded by gitignore/settings


This allows callers to distinguish between successfully indexed entries and those that were filtered out.

* * *

The worktree and file system subsystem provides the foundation for Zed's project management, maintaining an efficient, indexed view of the file system that integrates with git, respects ignore files, and supports both local and remote development scenarios. The snapshot-based architecture ensures consistency while allowing background updates, and the flexible entry system accommodates various file system features like symlinks and external directories.

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Worktree and File System](<#worktree-and-file-system>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [Worktree Architecture](<#worktree-architecture>)
  * [Entry System](<#entry-system>)
  * [Snapshot System](<#snapshot-system>)
  * [File System Monitoring and Scanning](<#file-system-monitoring-and-scanning>)
  * [Local vs Remote Worktrees](<#local-vs-remote-worktrees>)
  * [WorktreeStore](<#worktreestore>)
  * [Git Integration](<#git-integration>)
  * [Special Features](<#special-features>)
  * [Symlink Handling](<#symlink-handling>)
  * [Gitignore and File Filtering](<#gitignore-and-file-filtering>)
  * [File Operations](<#file-operations>)
