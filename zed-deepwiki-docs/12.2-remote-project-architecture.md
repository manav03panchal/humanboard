<!-- Source: https://deepwiki.com/zed-industries/zed/12.2-remote-project-architecture -->

# 12.2 Remote Project Architecture

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Remote Project Architecture

Relevant source files

  * [crates/collab/src/tests/editor_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/editor_tests.rs>)
  * [crates/collab/src/tests/integration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/integration_tests.rs>)
  * [crates/collab/src/tests/remote_editing_collaboration_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/remote_editing_collaboration_tests.rs>)
  * [crates/copilot/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/Cargo.toml>)
  * [crates/copilot/src/copilot.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/copilot.rs>)
  * [crates/copilot/src/sign_in.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/copilot/src/sign_in.rs>)
  * [crates/editor/src/hover_links.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/editor/src/hover_links.rs>)
  * [crates/fs/src/fs.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fs.rs>)
  * [crates/git/src/status.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/status.rs>)
  * [crates/lsp/src/lsp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/lsp/src/lsp.rs>)
  * [crates/prettier/src/prettier.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier.rs>)
  * [crates/prettier/src/prettier_server.js](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/prettier/src/prettier_server.js>)
  * [crates/project/src/buffer_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs>)
  * [crates/project/src/lsp_command.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs>)
  * [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>)
  * [crates/project/src/prettier_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/prettier_store.rs>)
  * [crates/project/src/project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs>)
  * [crates/project/src/project_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project_tests.rs>)
  * [crates/project/src/worktree_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs>)
  * [crates/proto/proto/lsp.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto>)
  * [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)
  * [crates/remote_server/src/remote_editing_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/remote_editing_tests.rs>)
  * [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>)
  * [crates/worktree/src/worktree_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree_tests.rs>)


## Purpose and Scope

This document explains Zed's remote project implementation, focusing on how operations are proxied from a local client to a remote host via RPC, how state is synchronized using Protocol Buffers, and the architecture that enables transparent remote development. For information about the general Local/Remote dual-mode pattern used across Zed's codebase, see [Local vs Remote Architecture Pattern](</zed-industries/zed/6.1-lsp-store-architecture>). For collaboration features involving multiple users sharing a project, see [Collaboration Features](</zed-industries/zed/6.3-completions-and-diagnostics>).

**Sources:** [crates/project/src/project.rs1-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs#L1-L400>) [crates/project/src/lsp_store.rs1-130](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L1-L130>)

* * *

## Overview

Zed's remote project architecture enables working with codebases on remote machines (typically via SSH) while maintaining the feel of local development. The architecture consists of:

  1. **Local Client** : Runs the full UI and handles user input
  2. **Remote Server** : Runs on the SSH host, managing file systems, LSP servers, and git repositories
  3. **RPC Protocol** : Protocol Buffer-based message passing between client and server
  4. **Dual-Mode Components** : Each major subsystem (LspStore, BufferStore, WorktreeStore, GitStore) has Local and Remote variants


**Sources:** [crates/project/src/project.rs270-283](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs#L270-L283>) [crates/remote_server/src/headless_project.rs45-63](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L45-L63>) [crates/project/src/lsp_store.rs1-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L1-L50>)

* * *

## Core Components

### Remote Project State

The `Project` entity maintains remote state in the `ProjectClientState::Remote` variant:


The remote state tracks:

  * `remote_id`: The project ID on the remote server (typically `REMOTE_SERVER_PROJECT_ID`)
  * `replica_id`: Unique identifier for this client's operations in CRDTs
  * `capability`: Read-only or read-write access
  * `sharing_has_stopped`: Whether the connection has been lost


**Sources:** [crates/project/src/project.rs270-283](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs#L270-L283>)

### RemoteClient and RPC Layer

The `RemoteClient` (exposed as `AnyProtoClient`) handles all RPC communication:


The `AnyProtoClient` provides:

  * **Request/Response** : `request()` method for synchronous RPC calls
  * **Entity Subscription** : Automatic message routing to entity handlers via `subscribe_to_entity()`
  * **Typed Envelopes** : Strong typing for all protocol buffer messages


**Sources:** [crates/project/src/lsp_store.rs91-94](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L91-L94>) [crates/rpc/src/proto.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/rpc/src/proto.rs>)

### Protocol Buffer Messages

All remote operations are defined as Protocol Buffer messages in `crates/proto/proto/*.proto`:

Operation Category| Proto Messages| Purpose  
---|---|---  
**Buffer**| `OpenBufferByPath`, `CreateBufferForPeer`, `UpdateBuffer`| Buffer synchronization  
**LSP**| `GetDefinition`, `GetHover`, `GetCompletions`, `PerformRename`| Language server requests  
**File System**| `ExpandProjectEntry`, `CreateProjectEntry`, `DeleteProjectEntry`| File operations  
**Worktree**| `UpdateWorktree`, `UpdateWorktreeSettings`| File tree synchronization  
**Git**| `GetRepositoryStatus`, `GetBlameForRange`| Git operations  
  
**Sources:** [crates/proto/proto/lsp.proto1-527](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto#L1-L527>) [crates/proto/proto/buffer.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/buffer.proto>) [crates/proto/proto/worktree.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/worktree.proto>)

* * *

## Dual-Mode Store Architecture

Each major subsystem has Local and Remote variants that implement a common interface:

### LspStore Pattern


The `RemoteLspStore` is a thin proxy that:

  1. Translates local LSP requests into Protocol Buffer messages
  2. Sends them via RPC to the remote `LocalLspStore`
  3. Deserializes responses back into local types


**Sources:** [crates/project/src/lsp_store.rs1-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L1-L50>) [crates/project/src/lsp_store.rs298-567](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L298-L567>)

### BufferStore Pattern


Remote buffer creation is a multi-step process:

  1. Client sends `OpenBufferByPath` request with worktree ID and path
  2. Server responds with `buffer_id`
  3. Server sends `CreateBufferForPeer` with buffer state (potentially in multiple chunks)
  4. Client assembles buffer and applies operations
  5. Ongoing edits are synchronized via `UpdateBuffer` messages


**Sources:** [crates/project/src/buffer_store.rs49-68](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L49-L68>) [crates/project/src/buffer_store.rs291-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L291-L318>) [crates/project/src/buffer_store.rs156-245](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L156-L245>)

### WorktreeStore Pattern


The `RemoteWorktree` receives periodic snapshots from the server via `UpdateWorktree` messages containing:

  * Added/modified entries with metadata
  * Removed entry IDs
  * Repository updates
  * Scan completion status


**Sources:** [crates/worktree/src/worktree.rs144-156](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L144-L156>) [crates/worktree/src/worktree.rs468-570](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L468-L570>) [crates/project/src/worktree_store.rs43-52](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs#L43-L52>)

* * *

## State Synchronization Mechanisms

### Buffer Operation Synchronization

Buffers use CRDTs (Conflict-free Replicated Data Types) to maintain consistency:


Buffer operations include:

  * `Insert`: Text insertion with position anchor
  * `Delete`: Text deletion with range anchors
  * `UpdateSelections`: Cursor/selection updates
  * `UpdateDiagnostics`: LSP diagnostics


**Sources:** [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>) [crates/project/src/buffer_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs>) [crates/proto/proto/buffer.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/buffer.proto>)

### Worktree Snapshot Synchronization


The worktree uses a two-snapshot approach:

  1. **Background snapshot** : Updated by background task processing proto messages
  2. **Foreground snapshot** : Periodically synced from background, used by UI


This prevents blocking the main thread during large worktree updates.

**Sources:** [crates/worktree/src/worktree.rs516-566](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs#L516-L566>) [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)

### LSP State Synchronization

LSP state is not directly synchronized; instead, each LSP request is proxied:


No LSP server state is replicated on the client; all requests are forwarded.

**Sources:** [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>) [crates/project/src/lsp_command.rs1-155](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L1-L155>) [crates/proto/proto/lsp.proto195-233](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto#L195-L233>)

* * *

## Operation Proxying Examples

### Opening a Remote Buffer


The buffer creation process handles large files by chunking operations:

  * Initial `CreateBufferForPeer::State` contains basic metadata
  * Follow-up `CreateBufferForPeer::Chunk` messages contain operations in batches
  * `is_last` flag signals completion


**Sources:** [crates/project/src/buffer_store.rs291-318](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L291-L318>) [crates/project/src/buffer_store.rs156-245](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L156-L245>) [crates/remote_server/src/headless_project.rs401-517](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L401-L517>)

### Executing LSP Go-to-Definition


Key transformation steps:

  1. Client editor position → `Anchor` (version-aware)
  2. `Anchor` → Protocol Buffer `Anchor` message
  3. Server: proto `Anchor` → `PointUtf16` → LSP `Position`
  4. LSP response: `Location` → domain `Location` with `Anchor`
  5. Domain `Location` → proto `Location` → client domain `Location`


**Sources:** [crates/project/src/lsp_command.rs175-178](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L175-L178>) [crates/project/src/lsp_command.rs1300-1500](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_command.rs#L1300-L1500>) [crates/proto/proto/lsp.proto8-17](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/lsp.proto#L8-L17>)

### Creating a File or Directory


File system operations follow a pattern:

  1. Client sends operation request
  2. Server executes on local file system
  3. Background scanner detects change and broadcasts `UpdateWorktree`
  4. Server responds with immediate result (entry metadata)


**Sources:** [crates/project/src/worktree_store.rs355-407](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs#L355-L407>) [crates/remote_server/src/headless_project.rs672-713](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L672-L713>)

* * *

## HeadlessProject on Remote Host

The SSH host runs a `HeadlessProject` that coordinates all local components. This is the server-side counterpart to the client's remote `Project`.

### HeadlessProject Structure and Initialization


**Sources:** [crates/remote_server/src/headless_project.rs45-63](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L45-L63>) [crates/remote_server/src/headless_project.rs74-260](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L74-L260>)

### Store Initialization and Sharing

Each store is created in local mode then shared with `REMOTE_SERVER_PROJECT_ID`:


The `REMOTE_SERVER_PROJECT_ID` constant (defined as `u64::MAX`) identifies the single project managed by the headless server. The `shared()` method sets up RPC message handlers for that store's protocol buffer messages.

**Sources:** [crates/remote_server/src/headless_project.rs74-180](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L74-L180>) [crates/rpc/src/proto.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/rpc/src/proto.rs>)

### RPC Handler Registration

`HeadlessProject` registers handlers for project-level operations not handled by individual stores:


Each handler receives a `TypedEnvelope<T>` containing the request and returns the appropriate response type. Handlers coordinate between stores to fulfill requests.

**Sources:** [crates/remote_server/src/headless_project.rs261-400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L261-L400>) [crates/remote_server/src/headless_project.rs518-850](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L518-L850>)

### Example: handle_add_worktree Implementation


The handler validates the path, delegates to `WorktreeStore` to create or find the worktree, and returns the worktree ID. The background scanner then sends incremental updates to the client.

**Sources:** [crates/remote_server/src/headless_project.rs638-671](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L638-L671>) [crates/project/src/worktree_store.rs355-407](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/worktree_store.rs#L355-L407>)

* * *

## RPC Communication Architecture

### Message Flow and TypedEnvelope

All RPC messages flow through the `AnyProtoClient` using `TypedEnvelope<T>`:


`TypedEnvelope<T>` structure:

  * `sender_id`: PeerId of sender (always `REMOTE_SERVER_PEER_ID` for server)
  * `message_id`: Unique message ID for request/response correlation
  * `payload`: The actual protocol buffer message


**Sources:** [crates/rpc/src/proto.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/rpc/src/proto.rs>) [crates/project/src/lsp_store.rs91-94](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L91-L94>)

### Handler Registration Patterns

There are three primary handler registration patterns:

Pattern| Method| Use Case| Example  
---|---|---|---  
**Entity Subscription**| `subscribe_to_entity()`| Auto-route messages to entity's handlers| `LspStore`, `BufferStore`  
**Request Handler**| `add_request_handler()`| Route to standalone function| `handle_add_worktree()`  
**Entity Request Handler**| `add_entity_request_handler()`| Route to entity method with state access| `buffer_store.handle_save_buffer()`  
  
**Entity Subscription Example:**


When a store calls `shared()`, it invokes `session.subscribe_to_entity()` which automatically registers handlers for all proto messages that have a corresponding `handle_*` method on the entity.

**Sources:** [crates/project/src/buffer_store.rs359-420](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L359-L420>) [crates/project/src/lsp_store.rs1-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L1-L50>)

### Response Correlation and Futures

Client-side RPC requests return `Task<Result<T::Response>>`:


Each request gets a unique `message_id`, and the client stores a oneshot channel in a `HashMap<MessageId, Sender<Result<Response>>>`. When the response arrives, it's matched by `message_id` and the sender fires, resolving the `Task`.

**Sources:** [crates/rpc/src/peer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/rpc/src/peer.rs>)

* * *

## Remote Service Management

### Language Server Lifecycle on Remote Host

Language servers run entirely on the remote host, managed by `LocalLspStore`:


Key lifecycle methods:

  * `start_language_server()`: Spawns server process and begins initialization
  * `get_language_server_binary()`: Downloads or locates server binary
  * `insert_newly_running_language_server()`: Transitions from Starting to Running state
  * Server shutdown: Triggered by connection loss or explicit cleanup


**Sources:** [crates/project/src/lsp_store.rs359-570](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L359-L570>) [crates/project/src/lsp_store.rs572-663](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L572-L663>)

### Service Coordination in HeadlessProject

`HeadlessProject` coordinates multiple services:


Services share common dependencies:

  * `ProjectEnvironment`: Provides shell environment variables and PATH resolution
  * `ToolchainStore`: Manages language-specific toolchain selection (e.g., Python virtualenvs)
  * `ManifestTree`: Tracks package manifests to locate server installations


**Sources:** [crates/remote_server/src/headless_project.rs74-180](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L74-L180>) [crates/project/src/lsp_store.rs254-299](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs#L254-L299>)

### Task Execution on Remote Host

Tasks execute on the remote host with proper environment setup:


Task execution includes:

  1. Environment resolution via `ProjectEnvironment`
  2. Toolchain activation (e.g., activating Python virtualenv)
  3. Working directory setup
  4. Environment variable merging
  5. Output streaming to client
  6. Exit code propagation


**Sources:** [crates/project/src/task_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/task_store.rs>) [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)

* * *

## Advanced Remote Operations

### Remote Search Implementation

Project-wide search is implemented efficiently on the remote host:


Search happens entirely on the remote host, with only match results sent to the client. This minimizes network traffic for large codebases.

**Sources:** [crates/remote_server/src/headless_project.rs851-1050](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L851-L1050>) [crates/project/src/search.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/search.rs>)

### Buffer Diff Base Management

Git diff base synchronization for remote buffers:


Diff bases are computed on the remote host and sent to the client. The client uses them to show inline diff decorations without accessing git directly.

**Sources:** [crates/remote_server/src/headless_project.rs913-980](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L913-L980>) [crates/project/src/git_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs>)

* * *

* * *

## Connection and Error Handling

### Connection Loss Detection and Recovery


When connection is lost:

  1. `Project` sets `ProjectClientState::Remote { sharing_has_stopped: true, ... }`
  2. `Project::is_read_only()` returns `true`, blocking all mutations
  3. `DisconnectedOverlay` modal displayed in workspace
  4. Auto-reconnect triggered after `RECONNECT_TIMEOUT` (30 seconds)
  5. If reconnection succeeds, project returns to normal operation
  6. If reconnection fails, user can manually retry or close workspace


**Sources:** [crates/project/src/project.rs270-283](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs#L270-L283>) [crates/collab/src/tests/editor_tests.rs48-182](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/tests/editor_tests.rs#L48-L182>)

### Buffer State Consistency

Buffers maintain consistency using CRDT operations with version vectors:


Every buffer operation includes:

  * `lamport_timestamp`: Monotonically increasing logical clock per replica
  * `replica_id`: Unique identifier for the editing session (assigned by server)


The buffer's `version` (a `clock::Global` vector clock) tracks the highest timestamp observed from each replica. When an operation arrives, the buffer checks if it has already been observed. This prevents duplicate application of operations in case of network retries or multiple sync paths.

**Sources:** [crates/language/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language/src/buffer.rs>) [crates/proto/proto/buffer.proto1-150](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/buffer.proto#L1-L150>) [crates/text/src/buffer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/text/src/buffer.rs>)

### RPC Error Propagation

RPC errors are propagated through the `Result` chain:


RPC request errors are wrapped in `anyhow::Error` with context:

  * `LSP_REQUEST_TIMEOUT`: Requests timeout after 120 seconds
  * Connection errors: Automatically trigger reconnection logic
  * Server errors: Logged and may show user notification
  * Decode errors: Indicate protocol version mismatch (rare)


Most operations have fallback behavior (e.g., empty completion list on error) to maintain editor responsiveness.

**Sources:** [crates/rpc/src/peer.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/rpc/src/peer.rs>) [crates/lsp/src/lsp.rs45-50](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/lsp/src/lsp.rs#L45-L50>) [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>)

* * *

## Performance Optimizations

### Request Batching

Multiple LSP requests can be coalesced:


Note: Current implementation sends individual requests; batching is a potential optimization.

**Sources:** [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>)

### Incremental Updates

Worktree updates only send deltas:

Field| Description| Size Impact  
---|---|---  
`updated_entries`| Only entries that changed| Proportional to changes  
`removed_entries`| IDs of removed entries| Small (just IDs)  
`updated_repositories`| Git repo state changes| Small (status only)  
`scan_id`| Scan sequence number| 8 bytes  
  
Full snapshots are never sent; clients maintain state and apply deltas.

**Sources:** [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) [crates/proto/proto/worktree.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/worktree.proto>)

### Buffer Chunk Streaming

Large buffers are streamed in chunks to avoid blocking:


This prevents the UI from freezing while loading large files.

**Sources:** [crates/project/src/buffer_store.rs156-245](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs#L156-L245>) [crates/remote_server/src/headless_project.rs401-517](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs#L401-L517>)

* * *

## Summary

Zed's remote project architecture achieves transparent remote development through:

  1. **Dual-Mode Pattern** : Every major subsystem has Local (server) and Remote (client proxy) variants
  2. **Protocol Buffers** : Strongly-typed RPC with efficient serialization
  3. **CRDT Synchronization** : Buffers use version vectors and anchors for conflict-free updates
  4. **Incremental Updates** : Only deltas are transmitted for worktrees and buffers
  5. **Entity Subscription** : Automatic message routing from RPC to appropriate store entities
  6. **Operation Proxying** : LSP and file system operations transparently forwarded to remote host


The architecture maintains the illusion of local development while all actual file I/O, language server execution, and git operations happen on the remote machine.

**Sources:** [crates/project/src/project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/project.rs>) [crates/project/src/lsp_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/lsp_store.rs>) [crates/project/src/buffer_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/buffer_store.rs>) [crates/worktree/src/worktree.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/worktree/src/worktree.rs>) [crates/remote_server/src/headless_project.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/remote_server/src/headless_project.rs>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Remote Project Architecture](<#remote-project-architecture>)
  * [Purpose and Scope](<#purpose-and-scope>)
  * [Overview](<#overview>)
  * [Core Components](<#core-components>)
  * [Remote Project State](<#remote-project-state>)
  * [RemoteClient and RPC Layer](<#remoteclient-and-rpc-layer>)
  * [Protocol Buffer Messages](<#protocol-buffer-messages>)
  * [Dual-Mode Store Architecture](<#dual-mode-store-architecture>)
  * [LspStore Pattern](<#lspstore-pattern>)
  * [BufferStore Pattern](<#bufferstore-pattern>)
  * [WorktreeStore Pattern](<#worktreestore-pattern>)
  * [State Synchronization Mechanisms](<#state-synchronization-mechanisms>)
  * [Buffer Operation Synchronization](<#buffer-operation-synchronization>)
  * [Worktree Snapshot Synchronization](<#worktree-snapshot-synchronization>)
  * [LSP State Synchronization](<#lsp-state-synchronization>)
  * [Operation Proxying Examples](<#operation-proxying-examples>)
  * [Opening a Remote Buffer](<#opening-a-remote-buffer>)
  * [Executing LSP Go-to-Definition](<#executing-lsp-go-to-definition>)
  * [Creating a File or Directory](<#creating-a-file-or-directory>)
  * [HeadlessProject on Remote Host](<#headlessproject-on-remote-host>)
  * [HeadlessProject Structure and Initialization](<#headlessproject-structure-and-initialization>)
  * [Store Initialization and Sharing](<#store-initialization-and-sharing>)
  * [RPC Handler Registration](<#rpc-handler-registration>)
  * [Example: handle_add_worktree Implementation](<#example-handle_add_worktree-implementation>)
  * [RPC Communication Architecture](<#rpc-communication-architecture>)
  * [Message Flow and TypedEnvelope](<#message-flow-and-typedenvelope>)
  * [Handler Registration Patterns](<#handler-registration-patterns>)
  * [Response Correlation and Futures](<#response-correlation-and-futures>)
  * [Remote Service Management](<#remote-service-management>)
  * [Language Server Lifecycle on Remote Host](<#language-server-lifecycle-on-remote-host>)
  * [Service Coordination in HeadlessProject](<#service-coordination-in-headlessproject>)
  * [Task Execution on Remote Host](<#task-execution-on-remote-host>)
  * [Advanced Remote Operations](<#advanced-remote-operations>)
  * [Remote Search Implementation](<#remote-search-implementation>)
  * [Buffer Diff Base Management](<#buffer-diff-base-management>)
  * [Connection and Error Handling](<#connection-and-error-handling>)
  * [Connection Loss Detection and Recovery](<#connection-loss-detection-and-recovery>)
  * [Buffer State Consistency](<#buffer-state-consistency>)
  * [RPC Error Propagation](<#rpc-error-propagation>)
  * [Performance Optimizations](<#performance-optimizations>)
  * [Request Batching](<#request-batching>)
  * [Incremental Updates](<#incremental-updates>)
  * [Buffer Chunk Streaming](<#buffer-chunk-streaming>)
  * [Summary](<#summary>)
