<!-- Source: https://deepwiki.com/zed-industries/zed/8.2-git-store-and-state-management -->

# 8.2 Git Store And State Management

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Git Store and State Management

Relevant source files

  * [crates/collab/src/rpc.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/collab/src/rpc.rs>)
  * [crates/fs/src/fake_git_repo.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/fs/src/fake_git_repo.rs>)
  * [crates/git/src/git.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/git.rs>)
  * [crates/git/src/repository.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/repository.rs>)
  * [crates/git_ui/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git_ui/Cargo.toml>)
  * [crates/git_ui/src/branch_picker.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git_ui/src/branch_picker.rs>)
  * [crates/git_ui/src/commit_modal.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git_ui/src/commit_modal.rs>)
  * [crates/git_ui/src/git_panel.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git_ui/src/git_panel.rs>)
  * [crates/git_ui/src/git_ui.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git_ui/src/git_ui.rs>)
  * [crates/git_ui/src/project_diff.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git_ui/src/project_diff.rs>)
  * [crates/project/src/git_store.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs>)
  * [crates/proto/proto/git.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/git.proto>)
  * [crates/proto/proto/zed.proto](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/zed.proto>)
  * [crates/proto/src/proto.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/src/proto.rs>)


This document describes how Zed manages git repository state across the application. The `GitStore` is responsible for maintaining repository state, coordinating buffer diffs, and synchronizing git information between local and remote projects.

For UI components and user interactions with git, see [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>). For actual git operations like commit and push, see [Repository Operations](</zed-industries/zed/8.3-repository-operations>). For diff computation and visualization, see [Diff System](</zed-industries/zed/8.4-diff-system>).

**Sources:** [crates/project/src/git_store.rs1-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L1-L100>)

* * *

## Architecture Overview

The git state management system consists of three primary layers: the `GitStore` orchestrator, individual `Repository` entities for each git repository, and per-buffer diff tracking. The system supports both local and remote operation modes, with state synchronization for collaborative editing.


**Sources:** [crates/project/src/git_store.rs89-102](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L89-L102>) [crates/project/src/git_store.rs156-168](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L156-L168>)

* * *

## GitStore Entity

The `GitStore` is the central entity that manages all git repositories within a project. It maintains a mapping of repositories, tracks the active repository, and coordinates buffer diffs.

### Core Structure

Field| Type| Purpose  
---|---|---  
`state`| `GitStoreState`| Local or Remote operation mode  
`buffer_store`| `Entity<BufferStore>`| Reference to buffer management  
`worktree_store`| `Entity<WorktreeStore>`| Reference to file tree management  
`repositories`| `HashMap<RepositoryId, Entity<Repository>>`| All known repositories  
`worktree_ids`| `HashMap<RepositoryId, HashSet<WorktreeId>>`| Worktrees per repository  
`active_repo_id`| `Option<RepositoryId>`| Currently active repository  
`diffs`| `HashMap<BufferId, Entity<BufferGitState>>`| Per-buffer diff state  
`loading_diffs`| `HashMap<(BufferId, DiffKind), Shared<Task>>`| Deduplication for diff loading  
`shared_diffs`| `HashMap<PeerId, HashMap<BufferId, SharedDiffs>>`| Diffs shared with remote peers  
  
**Sources:** [crates/project/src/git_store.rs89-102](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L89-L102>)

### Initialization


The `GitStore` can be initialized in two modes:

  * **Local** : For direct file system access with optional downstream RPC client
  * **Remote** : For proxying operations to a remote server


**Sources:** [crates/project/src/git_store.rs404-441](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L404-L441>)

### Active Repository Management

The active repository is the one currently selected for UI display and operations. It changes based on user focus and file context.


**Sources:** [crates/project/src/git_store.rs517-525](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L517-L525>)

* * *

## Repository Entity and State

Each git repository is represented by a `Repository` entity that wraps an immutable `RepositorySnapshot` and manages asynchronous operations.

### Repository Structure


**Sources:** [crates/project/src/git_store.rs278-293](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L278-L293>) [crates/project/src/git_store.rs248-268](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L248-L268>)

### RepositorySnapshot

The `RepositorySnapshot` is an immutable representation of repository state at a point in time. It can be cloned cheaply and compared for changes.


The `statuses_by_path` uses a `SumTree` data structure for efficient querying by path prefix and maintaining summary statistics.

**Sources:** [crates/project/src/git_store.rs248-268](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L248-L268>)

### StatusEntry and Summaries


The `SumTree` provides O(log n) access to status entries by path and maintains aggregated statistics through the `GitSummary` type.

**Sources:** [crates/project/src/git_store.rs182-243](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L182-L243>) [crates/git/src/status.rs1-100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/git/src/status.rs#L1-L100>)

### RepositoryState Variants

The `RepositoryState` enum determines whether operations are performed locally or proxied remotely:


**Sources:** [crates/project/src/git_store.rs303-361](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L303-L361>)

* * *

## State Synchronization

The `GitStore` supports both hosting (local) and guest (remote) modes for collaborative editing. State synchronization ensures all participants see consistent git information.

### Local State with Downstream Clients

When a `GitStore` is shared, it maintains a downstream client connection to send state updates.


**Sources:** [crates/project/src/git_store.rs527-606](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L527-L606>)

### Remote State with Upstream Proxy

A remote `GitStore` forwards all operations to the upstream server:


All repository operations like `stage_paths`, `commit`, `push` are forwarded as RPC requests.

**Sources:** [crates/project/src/git_store.rs1700-2100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L1700-L2100>)

### Update Protocol

Repository updates are sent using the `UpdateRepository` protobuf message which can be split into multiple messages for large updates:


The `split_repository_update` function ensures messages stay under size limits by breaking apart status entries.

**Sources:** [crates/project/src/git_store.rs527-606](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L527-L606>) [crates/proto/proto/git.proto113-129](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/proto/proto/git.proto#L113-L129>)

* * *

## Buffer Diff Management

The `GitStore` manages per-buffer diffs in two flavors: **unstaged** (working tree vs index) and **uncommitted** (working tree vs HEAD).

### BufferGitState

Each buffer has associated git state tracking its diffs and conflict markers:


**Sources:** [crates/project/src/git_store.rs110-137](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L110-L137>)

### DiffKind and Base Texts

The system manages two types of diffs:

DiffKind| Base| Comparison| Use Case  
---|---|---|---  
`Unstaged`| Index (staged)| Working tree| Show unstaged changes  
`Uncommitted`| HEAD (committed)| Working tree| Show all uncommitted changes  
  

**Sources:** [crates/project/src/git_store.rs150-154](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L150-L154>)

### Opening Diffs

The `open_unstaged_diff` and `open_uncommitted_diff` methods load base text and create `BufferDiff` entities:


The `loading_diffs` map ensures that multiple requests for the same buffer diff share a single loading task.

**Sources:** [crates/project/src/git_store.rs636-689](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L636-L689>)

### Diff Base Text Loading

Base text is loaded asynchronously from the git repository:


**Sources:** [crates/project/src/git_store.rs1190-1250](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L1190-L1250>)

### Hunk Staging Coordination

When a user stages or unstages a hunk, the system must coordinate several operations:

  1. Increment operation count immediately
  2. Write new index text to git index
  3. Update operation count as of write
  4. Reload base texts for affected buffers
  5. Recalculate diffs


The operation counts ensure that stale base texts are not used after a staging operation.

**Sources:** [crates/project/src/git_store.rs1520-1680](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L1520-L1680>)

* * *

## Event Flow

The `GitStore` emits events to notify other parts of the application about git state changes.

### Event Types


**Sources:** [crates/project/src/git_store.rs376-384](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L376-L384>)

### Repository Events

Individual repositories emit their own events:


**Sources:** [crates/project/src/git_store.rs363-370](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L363-L370>)

### Event Propagation


**Sources:** [crates/project/src/git_store.rs2600-2700](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L2600-L2700>)

* * *

## Repository Lifecycle

### Addition and Discovery

Repositories are discovered through worktree events:


**Sources:** [crates/project/src/git_store.rs2600-2800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L2600-L2800>)

### Status Updates

Repository status is refreshed in response to file system changes:


**Sources:** [crates/project/src/git_store.rs3400-3600](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L3400-L3600>)

### Job Queue

Each repository maintains a job queue for asynchronous git operations:


Jobs are deduplicated by key to prevent redundant operations:


**Sources:** [crates/project/src/git_store.rs390-401](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L390-L401>) [crates/project/src/git_store.rs3200-3400](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L3200-L3400>)

### Removal

When a worktree containing a repository is removed:


**Sources:** [crates/project/src/git_store.rs2700-2900](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L2700-L2900>)

* * *

## Pending Operations

The `GitStore` tracks long-running git operations (push, pull, fetch) to display progress in the UI.

### PendingOps Structure


The `SumTree` structure allows efficient insertion and removal of pending operations while maintaining summary statistics.

**Sources:** [crates/project/src/git_store/pending_op.rs1-150](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store/pending_op.rs#L1-L150>)

### Operation Lifecycle


**Sources:** [crates/project/src/git_store.rs1900-2100](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L1900-L2100>)

* * *

## Summary

The `GitStore` provides a comprehensive state management layer for git integration:

  * **Centralized Management** : Single source of truth for all repository state
  * **Efficient Indexing** : `SumTree`-based status tracking for O(log n) queries
  * **Local/Remote Transparency** : Same API works for both local and remote projects
  * **Diff Coordination** : Per-buffer diff tracking with staging operation coordination
  * **Event-Driven Updates** : Reactive architecture keeps UI synchronized
  * **Collaborative Support** : State synchronization for real-time collaboration
  * **Operation Tracking** : Progress monitoring for long-running git operations


The system balances performance (asynchronous operations, deduplication) with correctness (operation counts, snapshot immutability) while maintaining a clean separation between state management, operations, and UI.

**Sources:** [crates/project/src/git_store.rs1-3800](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/project/src/git_store.rs#L1-L3800>)

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Git Store and State Management](<#git-store-and-state-management>)
  * [Architecture Overview](<#architecture-overview>)
  * [GitStore Entity](<#gitstore-entity>)
  * [Core Structure](<#core-structure>)
  * [Initialization](<#initialization>)
  * [Active Repository Management](<#active-repository-management>)
  * [Repository Entity and State](<#repository-entity-and-state>)
  * [Repository Structure](<#repository-structure>)
  * [RepositorySnapshot](<#repositorysnapshot>)
  * [StatusEntry and Summaries](<#statusentry-and-summaries>)
  * [RepositoryState Variants](<#repositorystate-variants>)
  * [State Synchronization](<#state-synchronization>)
  * [Local State with Downstream Clients](<#local-state-with-downstream-clients>)
  * [Remote State with Upstream Proxy](<#remote-state-with-upstream-proxy>)
  * [Update Protocol](<#update-protocol>)
  * [Buffer Diff Management](<#buffer-diff-management>)
  * [BufferGitState](<#buffergitstate>)
  * [DiffKind and Base Texts](<#diffkind-and-base-texts>)
  * [Opening Diffs](<#opening-diffs>)
  * [Diff Base Text Loading](<#diff-base-text-loading>)
  * [Hunk Staging Coordination](<#hunk-staging-coordination>)
  * [Event Flow](<#event-flow>)
  * [Event Types](<#event-types>)
  * [Repository Events](<#repository-events>)
  * [Event Propagation](<#event-propagation>)
  * [Repository Lifecycle](<#repository-lifecycle>)
  * [Addition and Discovery](<#addition-and-discovery>)
  * [Status Updates](<#status-updates>)
  * [Job Queue](<#job-queue>)
  * [Removal](<#removal>)
  * [Pending Operations](<#pending-operations>)
  * [PendingOps Structure](<#pendingops-structure>)
  * [Operation Lifecycle](<#operation-lifecycle>)
  * [Summary](<#summary>)
