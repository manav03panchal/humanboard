<!-- Source: https://deepwiki.com/zed-industries/zed/11.4-tool-system -->

# 11.4 Tool System

Loading...

Index your code with Devin

[DeepWiki](</>)

[DeepWiki](</>)

[zed-industries/zed ](<https://github.com/zed-industries/zed> "Open repository")

Index your code with

Devin

Edit WikiShare

Loading...

Last indexed: 16 December 2025 ([4109c9](<https://github.com/zed-industries/zed/commits/4109c9dd>))

  * [Overview](</zed-industries/zed/1-overview>)
  * [Core Architecture](</zed-industries/zed/2-core-architecture>)
  * [Application Initialization and Lifecycle](</zed-industries/zed/2.1-application-initialization-and-lifecycle>)
  * [GPUI Framework](</zed-industries/zed/2.2-gpui-framework>)
  * [Window and Platform Abstraction](</zed-industries/zed/2.3-window-and-platform-abstraction>)
  * [Event Flow and Input Handling](</zed-industries/zed/2.4-event-flow-and-input-handling>)
  * [Keybinding and Action System](</zed-industries/zed/2.5-keybinding-and-action-system>)
  * [Focus Management and Hit Testing](</zed-industries/zed/2.6-focus-management-and-hit-testing>)
  * [Editor Architecture](</zed-industries/zed/3-editor-architecture>)
  * [Editor Component and UI](</zed-industries/zed/3.1-editor-component-and-ui>)
  * [Buffer System and Text Storage](</zed-industries/zed/3.2-buffer-system-and-text-storage>)
  * [Display Pipeline and Rendering](</zed-industries/zed/3.3-display-pipeline-and-rendering>)
  * [Selections and Editing Operations](</zed-industries/zed/3.4-selections-and-editing-operations>)
  * [Code Intelligence Integration](</zed-industries/zed/3.5-code-intelligence-integration>)
  * [Diff Integration](</zed-industries/zed/3.6-diff-integration>)
  * [Workspace and Panel System](</zed-industries/zed/4-workspace-and-panel-system>)
  * [Workspace Organization](</zed-industries/zed/4.1-workspace-organization>)
  * [Item System and Lifecycle](</zed-industries/zed/4.2-item-system-and-lifecycle>)
  * [Pane Management](</zed-industries/zed/4.3-pane-management>)
  * [Search System](</zed-industries/zed/4.4-search-system>)
  * [Project Management](</zed-industries/zed/5-project-management>)
  * [Project Orchestration](</zed-industries/zed/5.1-project-orchestration>)
  * [Worktree and File System](</zed-industries/zed/5.2-worktree-and-file-system>)
  * [Buffer Store](</zed-industries/zed/5.3-buffer-store>)
  * [Language Intelligence](</zed-industries/zed/6-language-intelligence>)
  * [LSP Store Architecture](</zed-industries/zed/6.1-lsp-store-architecture>)
  * [Language Server Lifecycle](</zed-industries/zed/6.2-language-server-lifecycle>)
  * [Completions and Diagnostics](</zed-industries/zed/6.3-completions-and-diagnostics>)
  * [Multi-Language Server Coordination](</zed-industries/zed/6.4-multi-language-server-coordination>)
  * [Settings and Configuration](</zed-industries/zed/7-settings-and-configuration>)
  * [Settings Store and Layering](</zed-industries/zed/7.1-settings-store-and-layering>)
  * [Settings UI](</zed-industries/zed/7.2-settings-ui>)
  * [Settings Migration](</zed-industries/zed/7.3-settings-migration>)
  * [Keymap System](</zed-industries/zed/7.4-keymap-system>)
  * [Git Integration](</zed-industries/zed/8-git-integration>)
  * [Git Panel and UI](</zed-industries/zed/8.1-git-panel-and-ui>)
  * [Git Store and State Management](</zed-industries/zed/8.2-git-store-and-state-management>)
  * [Repository Operations](</zed-industries/zed/8.3-repository-operations>)
  * [Diff System](</zed-industries/zed/8.4-diff-system>)
  * [Terminal and Task Execution](</zed-industries/zed/9-terminal-and-task-execution>)
  * [Terminal Core](</zed-industries/zed/9.1-terminal-core>)
  * [Terminal View and Rendering](</zed-industries/zed/9.2-terminal-view-and-rendering>)
  * [Task System](</zed-industries/zed/9.3-task-system>)
  * [Vim Mode](</zed-industries/zed/10-vim-mode>)
  * [Mode State Machine](</zed-industries/zed/10.1-mode-state-machine>)
  * [Operators, Motions, and Objects](</zed-industries/zed/10.2-operators-motions-and-objects>)
  * [Visual Mode](</zed-industries/zed/10.3-visual-mode>)
  * [Helix Mode Integration](</zed-industries/zed/10.4-helix-mode-integration>)
  * [AI Agent System](</zed-industries/zed/11-ai-agent-system>)
  * [Agent Communication Protocol (ACP)](</zed-industries/zed/11.1-agent-communication-protocol-\(acp\)>)
  * [Agent UI and Thread Management](</zed-industries/zed/11.2-agent-ui-and-thread-management>)
  * [Agent Connection and Implementations](</zed-industries/zed/11.3-agent-connection-and-implementations>)
  * [Tool System](</zed-industries/zed/11.4-tool-system>)
  * [Mention System and Context](</zed-industries/zed/11.5-mention-system-and-context>)
  * [Legacy Agent Thread System](</zed-industries/zed/11.6-legacy-agent-thread-system>)
  * [Remote Development and Collaboration](</zed-industries/zed/12-remote-development-and-collaboration>)
  * [Local vs Remote Architecture](</zed-industries/zed/12.1-local-vs-remote-architecture>)
  * [Remote Project Architecture](</zed-industries/zed/12.2-remote-project-architecture>)
  * [Collaboration Features](</zed-industries/zed/12.3-collaboration-features>)
  * [CRDT and Synchronization](</zed-industries/zed/12.4-crdt-and-synchronization>)


Menu

# Agent Tools and Capabilities

Relevant source files

  * [crates/acp_thread/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/Cargo.toml>)
  * [crates/acp_thread/src/acp_thread.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs>)
  * [crates/acp_thread/src/connection.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/connection.rs>)
  * [crates/acp_thread/src/mention.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/mention.rs>)
  * [crates/agent_servers/Cargo.toml](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/Cargo.toml>)
  * [crates/agent_servers/src/acp.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/acp.rs>)
  * [crates/agent_servers/src/agent_servers.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/agent_servers.rs>)
  * [crates/agent_servers/src/claude.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/claude.rs>)
  * [crates/agent_servers/src/custom.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/custom.rs>)
  * [crates/agent_servers/src/e2e_tests.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/e2e_tests.rs>)
  * [crates/agent_servers/src/gemini.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/gemini.rs>)
  * [crates/agent_ui/src/acp/entry_view_state.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/entry_view_state.rs>)
  * [crates/agent_ui/src/acp/message_editor.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/message_editor.rs>)
  * [crates/agent_ui/src/acp/thread_view.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs>)
  * [crates/agent_ui/src/agent_panel.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_panel.rs>)


This document describes the agent tool system in Zed, which enables AI agents to interact with the development environment through structured actions. Tools allow agents to read and modify files, run terminal commands, search code, access diagnostics, and more.

For information about the conversational agent architecture that uses these tools, see [Conversational Agent Architecture](</zed-industries/zed/4.2-item-system-and-lifecycle>). For details about the ACP Thread implementation, see [ACP Thread and UI Components](<#4.2.2>).

* * *

## Tool Architecture Overview

The agent tool system is built on a trait-based architecture that separates tool definition from execution. Tools are registered with agent threads and invoked through the Agent Client Protocol (ACP) when the language model requests their use.


**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>) [crates/agent/src/thread.rs593](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L593-L593>) [crates/acp_thread/src/acp_thread.rs176-186](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L176-L186>)

### AnyAgentTool Trait

The `AnyAgentTool` trait in [crates/agent/src/tools.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/tools.rs>) defines the interface that all tools must implement. Each tool provides:

Method| Purpose  
---|---  
`initial_title`| Returns the display title when the tool is first called  
`kind`| Returns the `acp::ToolKind` (File, Terminal, Search, Diagnostic, Other)  
`run`| Executes the tool with given input, emits results via `ToolCallEventStream`, and returns `LanguageModelToolResult`  
`replay`| Re-renders tool results from stored output (for persisted threads)  
`json_schema`| Provides the JSON schema for tool input validation as `LanguageModelRequestTool`  
`approve_all_by_default`| Whether the tool should be auto-approved without user confirmation  
  
**Sources:** [crates/agent/src/tools.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/tools.rs>) [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

* * *

## Built-in Tools Catalog

Zed provides a comprehensive set of built-in tools that agents can use to interact with the development environment:

### File Operations Tools

#### Diagram: File Tool Architecture


**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

#### ReadFileTool

Reads the contents of one or more files from the project. The tool tracks file modification times in `Thread.file_read_times` to detect external changes between when the agent reads a file and when it attempts to edit it.

**Input Schema:**

  * `paths`: Array of file paths to read (relative to project root)


**Output:** File contents with metadata including line counts and modification times, formatted as markdown code blocks.

**Authorization:** Auto-approved (does not require user confirmation).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>) [crates/agent/src/thread.rs616](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L616-L616>)

#### EditFileTool

Applies unified diff patches to files. This is the primary tool for making code changes. The tool:

  1. Validates that files haven't been modified since they were read using `Thread.file_read_times`
  2. Applies the diff using streaming diff application
  3. Formats the file if `FormatOnSave` is enabled in language settings
  4. Returns the resulting diff for display


**Input Schema:**

  * `path`: Target file path
  * `diff`: Unified diff format string
  * `old_text`: Optional baseline text for validation


**Output:** `acp::ToolCallContent::Diff` with before/after text and language-aware syntax highlighting.

**Authorization:** Requires user confirmation (unless previously approved).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>) [crates/acp_thread/src/acp_thread.rs616-624](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L616-L624>)

#### TerminalTool

Executes shell commands in a managed terminal. The tool:

  * Creates a new terminal instance via `ThreadEnvironment.create_terminal`
  * Streams output in real-time via `Terminal.wait_for_output` and `Terminal.current_output`
  * Captures exit status via `Terminal.wait_for_exit`
  * Supports custom working directories
  * Enforces output byte limits to prevent overwhelming the context


**Input Schema:**

  * `command`: Shell command to execute
  * `cwd`: Optional working directory (defaults to project root)
  * `output_byte_limit`: Optional limit on captured output


**Output:** `acp::ToolCallContent::Terminal` with streaming output and exit status (`acp::TerminalExitStatus`).

**Authorization:** Requires user confirmation with options for terminal-specific permissions (unless previously approved).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>) [crates/agent/src/thread.rs529-543](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L529-L543>) [crates/acp_thread/src/acp_thread.rs625-630](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L625-L630>) [crates/acp_thread/src/terminal.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/terminal.rs>)

### Search and Discovery Tools

#### GrepTool

Performs text search across the project using regex patterns via `Project::search`. Supports:

  * Regular expression patterns
  * Case-sensitive/insensitive search
  * File inclusion/exclusion patterns
  * Result limiting


**Input Schema:**

  * `pattern`: Regex pattern to search for
  * `case_sensitive`: Boolean flag
  * `include_glob`: Optional glob pattern for files to include
  * `exclude_glob`: Optional glob pattern for files to exclude
  * `max_results`: Maximum number of results to return


**Authorization:** Auto-approved (read-only operation).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

#### FindPathTool

Searches for files by name or path pattern using `Project::find`. More efficient than grep for finding files by name.

**Input Schema:**

  * `pattern`: File name or path pattern
  * `glob`: Optional glob pattern for filtering


**Authorization:** Auto-approved (read-only operation).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

#### OpenTool

Opens files in the editor UI, making them visible to the user. This allows the agent to draw attention to specific files.

**Input Schema:**

  * `paths`: Array of file paths to open


**Authorization:** Auto-approved (UI operation, non-destructive).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

### Development Environment Tools

#### DiagnosticsTool

Retrieves compiler errors, warnings, and linter messages from language servers via `Project::diagnostic_summaries`. This allows agents to:

  * Identify compilation errors
  * Fix linter warnings
  * Understand type errors
  * Respond to code quality issues


**Input Schema:**

  * `path`: Optional file path to filter diagnostics (or all project diagnostics if omitted)


**Output:** List of diagnostics with severity, message, location, and source, formatted as markdown.

**Authorization:** Auto-approved (read-only operation).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

#### ThinkingTool

A special tool that allows the agent to record internal reasoning without executing external actions. The output is marked as "thinking" content and may be redacted in the UI depending on model capabilities.

**Input Schema:**

  * `thought`: The agent's reasoning text


**Output:** Stored as `AgentMessageContent::Thinking` with optional signature for verification.

**Authorization:** Auto-approved (internal operation).

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

### Context Gathering Tools

#### FetchTool

Fetches content from HTTP/HTTPS URLs and converts it to markdown. Useful for:

  * Reading API documentation
  * Fetching example code from GitHub
  * Accessing web resources


**Input Schema:**

  * `url`: URL to fetch


**Output:** Markdown-formatted content.

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

#### WebSearchTool

Performs web searches and retrieves results. Requires external search provider configuration.

**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

#### NowTool

Returns the current date and time. Useful for:

  * Generating timestamps in code
  * Understanding relative time references
  * Creating date-based naming


**Sources:** [crates/agent/src/thread.rs1-6](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L1-L6>)

* * *

## Tool Execution Flow

The complete lifecycle of a tool call involves multiple layers of the system, from the language model's request through execution to result display.

#### Diagram: Tool Call Execution Sequence


**Sources:** [crates/agent/src/thread.rs700-783](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L700-L783>) [crates/acp_thread/src/acp_thread.rs1049-1127](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L1049-L1127>) [crates/agent/src/thread.rs545-570](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L545-L570>)

### Tool Call Lifecycle States

Tool calls progress through several states during execution, tracked by the `ToolCallStatus` enum:

Status| Description| Code Location  
---|---|---  
`Pending`| Tool call received but not yet started| [crates/acp_thread/src/acp_thread.rs414](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L414-L414>)  
`WaitingForConfirmation`| User authorization required before execution; contains `options: Vec<acp::PermissionOption>` and `respond_tx: oneshot::Sender`| [crates/acp_thread/src/acp_thread.rs416-419](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L416-L419>)  
`InProgress`| Tool is actively executing| [crates/acp_thread/src/acp_thread.rs421](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L421-L421>)  
`Completed`| Tool finished successfully| [crates/acp_thread/src/acp_thread.rs423](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L423-L423>)  
`Failed`| Tool encountered an error| [crates/acp_thread/src/acp_thread.rs425](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L425-L425>)  
`Rejected`| User rejected the tool call authorization| [crates/acp_thread/src/acp_thread.rs427](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L427-L427>)  
`Canceled`| User canceled generation before tool completed| [crates/acp_thread/src/acp_thread.rs429](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L429-L429>)  
  
The status is converted from `acp::ToolCallStatus` when tool calls are created or updated in `AcpThread`.

**Sources:** [crates/acp_thread/src/acp_thread.rs410-460](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L410-L460>)

### ToolCallEventStream and ThreadEventStream

Tools emit structured updates through the `ToolCallEventStream` wrapper, which internally uses `ThreadEventStream` to send `ThreadEvent` messages:

**Key methods:**

  * `send_tool_call(id, name, title, kind, raw_input)` \- Emits initial `ThreadEvent::ToolCall` with `acp::ToolCall`
  * `update_tool_call_fields(id, fields)` \- Emits `ThreadEvent::ToolCallUpdate` with `acp::ToolCallUpdateFields`
  * `send_diff(diff_content, path)` \- For file edits, emits diff content
  * `send_terminal(terminal_id)` \- For terminal tools, emits terminal reference
  * `send_markdown_block(content)` \- Emits generic content as `acp::ContentBlock::Text`


The `ThreadEventStream` wraps an `mpsc::UnboundedSender<Result<ThreadEvent>>` and implements methods that convert tool-specific events into the appropriate `ThreadEvent` variant.

**Sources:** [crates/agent/src/tools.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/tools.rs>) [crates/agent/src/thread.rs545-570](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L545-L570>)

* * *

## Tool Authorization System

To prevent unauthorized actions, certain tools require explicit user permission before execution. The authorization system provides both one-time and persistent approval options.


**Sources:** [crates/agent_ui/src/acp/thread_view.rs70-74](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L70-L74>) [crates/acp_thread/src/acp_thread.rs405-408](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L405-L408>)

### Authorization Logic

Tools declare whether they require authorization through the `approve_all_by_default` method. By default:

  * **Auto-approved** : `ReadFileTool`, `DiagnosticsTool`, `GrepTool`, `FindPathTool`, `ListDirectoryTool`, `FetchTool`, `NowTool`, `OpenTool`, `ThinkingTool`, `WebSearchTool`
  * **Requires authorization** : `EditFileTool`, `TerminalTool`, `DeletePathTool`, `MovePathTool`, `CopyPathTool`, `CreateDirectoryTool`


When the agent requests a tool that requires authorization:

  1. The tool call status is set to `ToolCallStatus::WaitingForConfirmation` with `PermissionOption` array
  2. UI displays `AgentNotification` window with permission choices
  3. User selects option (AllowOnce, AllowAlways, RejectOnce, RejectAll)
  4. If "AllowAlways" selected, tool name is added to `AgentSettings.approved_tools` via settings file update
  5. Future invocations check `AgentSettings.approved_tools` and skip the authorization prompt


**Sources:** [crates/agent/src/tools.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/tools.rs>) [crates/agent_settings/src/agent_settings.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_settings/src/agent_settings.rs>) [crates/acp_thread/src/acp_thread.rs416-419](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L416-L419>) [crates/agent_ui/src/acp/thread_view.rs70-74](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/acp/thread_view.rs#L70-L74>)

* * *

## Tool Results and Display

Tool results are rendered differently based on the tool kind and content type. The UI layer handles three primary content types:

### Content Block Rendering

Simple text-based tool results are rendered as markdown:


**Sources:** [crates/acp_thread/src/acp_thread.rs450-578](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L450-L578>)

### Diff Display

File edit results are rendered as side-by-side diffs with syntax highlighting:

**Structure:**

  * `Diff` entity contains `base_text` (original) and `new_text` (modified)
  * `BufferDiff` computes hunks showing changed regions
  * `Editor` displays the diff with appropriate language syntax highlighting
  * Users can accept/reject individual hunks or the entire diff


**Sources:** [crates/acp_thread/src/acp_thread.rs602-610](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L602-L610>) [crates/acp_thread/src/diff.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/diff.rs>) [crates/agent_ui/src/agent_diff.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_ui/src/agent_diff.rs>)

### Terminal Output Display

Terminal tool results are rendered in an embedded terminal view:

**Features:**

  * Real-time output streaming as the command executes
  * ANSI color and formatting support
  * Scrollable history
  * Exit status indication
  * Output can be moved to background terminals panel when complete


**Sources:** [crates/acp_thread/src/acp_thread.rs611-616](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/acp_thread.rs#L611-L616>) [crates/acp_thread/src/terminal.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/acp_thread/src/terminal.rs>)

* * *

## Custom Tools via Context Servers

Beyond built-in tools, agents can access custom tools provided by Context Servers implementing the Model Context Protocol (MCP).

#### Diagram: Context Server Tool Integration


### Context Server Integration

Context servers are discovered through configuration and expose their tools via JSON-RPC. The `ContextServerRegistry` in [crates/agent/src/context_server.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/context_server.rs>) maintains connections to active servers and makes their tools available to agents.

**Tool Resolution Order:**

  1. Check `Thread.tools: BTreeMap<SharedString, Arc<dyn AnyAgentTool>>` for built-in tools
  2. Check `ContextServerRegistry.servers()` for server-provided tools
  3. Return error if tool not found (displays failed tool call in UI)


When an agent connects, MCP servers are passed in the `acp::NewSessionRequest.mcp_servers` field, allowing external agents to connect to the same context servers.

**Sources:** [crates/agent/src/thread.rs719-732](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L719-L732>) [crates/agent_servers/src/acp.rs252-298](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent_servers/src/acp.rs#L252-L298>)

* * *

## Tool Call Replay and Persistence

When loading persisted agent threads from the database, tool calls must be "replayed" to reconstruct their visual state without re-executing them.

#### Diagram: Tool Replay Sequence


**Key Differences from Normal Execution:**

  * `AnyAgentTool.replay(input, output, stream)` is called instead of `run()`
  * Tool receives both input (`serde_json::Value`) and stored output (`serde_json::Value`)
  * No actual side effects occur (no files modified, no commands run)
  * Visual state is reconstructed from stored `AgentMessage.tool_results` data


**Sources:** [crates/agent/src/thread.rs680-712](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L680-L712>) [crates/agent/src/thread.rs714-783](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L714-L783>)

* * *

## Tool Telemetry and Metrics

The evaluation framework tracks tool usage metrics to measure agent effectiveness:

Metric| Description  
---|---  
Tool name| Which tool was invoked  
Success/failure| Whether the tool completed successfully  
Invocation count| Number of times each tool was called  
Sequence| Order of tool invocations  
  
In evaluation runs, these metrics help determine:

  * Which tools agents prefer for specific tasks
  * Success rates for different tools
  * Common failure patterns
  * Tool usage efficiency


**Sources:** [crates/eval/src/example.rs92-98](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/eval/src/example.rs#L92-L98>) [crates/eval/src/example.rs255-309](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/eval/src/example.rs#L255-L309>) [crates/eval/src/tool_metrics.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/eval/src/tool_metrics.rs>)

* * *

## Tool Limits and Error Handling

Several mechanisms prevent tool abuse and handle errors gracefully:

### Tool Use Limits

Language model providers may enforce limits on the number of tool calls per turn or per thread. When limits are reached:

  1. Language model returns `LanguageModelCompletionError` with `ToolUseLimitReachedError`
  2. Thread sets `Thread.tool_use_limit_reached: bool` flag
  3. `ThreadView` displays appropriate error message in UI
  4. User must create a new thread to continue


The flag is checked before executing tools and persisted in `DbThread` for thread restoration.

**Sources:** [crates/agent/src/thread.rs599](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L599-L599>) [crates/language_model/src/language_model.rs](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/language_model/src/language_model.rs>)

### File Read Tracking

To detect external file modifications, the `Thread` tracks when files are read:


Before editing a file, the `EditFileTool` checks if the file's modification time has changed since it was read. If so, it returns an error preventing conflicting edits.

**Sources:** [crates/agent/src/thread.rs611](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L611-L611>)

### Retry Logic

When tool execution fails due to transient errors (network issues, rate limits, etc.), the system implements exponential backoff retry logic:


**Sources:** [crates/agent/src/thread.rs78-91](<https://github.com/zed-industries/zed/blob/4109c9dd/crates/agent/src/thread.rs#L78-L91>)

* * *

## Summary

The agent tool system provides a comprehensive, extensible framework for AI agents to interact with the development environment:

  * **Built-in tools** cover file operations, terminal execution, search, diagnostics, and context gathering
  * **Authorization system** ensures user control over potentially destructive operations
  * **Structured output** with diffs, terminal views, and markdown rendering
  * **Persistence and replay** enable thread restoration across sessions
  * **Context Server integration** allows unlimited tool extensibility
  * **Telemetry and limits** provide observability and safety


This architecture enables agents to function as effective coding assistants while maintaining user control and system safety.

Dismiss

Refresh this wiki

This wiki was recently refreshed. Please wait 7 days to refresh again.

### On this page

  * [Agent Tools and Capabilities](<#agent-tools-and-capabilities>)
  * [Tool Architecture Overview](<#tool-architecture-overview>)
  * [AnyAgentTool Trait](<#anyagenttool-trait>)
  * [Built-in Tools Catalog](<#built-in-tools-catalog>)
  * [File Operations Tools](<#file-operations-tools>)
  * [Diagram: File Tool Architecture](<#diagram-file-tool-architecture>)
  * [ReadFileTool](<#readfiletool>)
  * [EditFileTool](<#editfiletool>)
  * [TerminalTool](<#terminaltool>)
  * [Search and Discovery Tools](<#search-and-discovery-tools>)
  * [GrepTool](<#greptool>)
  * [FindPathTool](<#findpathtool>)
  * [OpenTool](<#opentool>)
  * [Development Environment Tools](<#development-environment-tools>)
  * [DiagnosticsTool](<#diagnosticstool>)
  * [ThinkingTool](<#thinkingtool>)
  * [Context Gathering Tools](<#context-gathering-tools>)
  * [FetchTool](<#fetchtool>)
  * [WebSearchTool](<#websearchtool>)
  * [NowTool](<#nowtool>)
  * [Tool Execution Flow](<#tool-execution-flow>)
  * [Diagram: Tool Call Execution Sequence](<#diagram-tool-call-execution-sequence>)
  * [Tool Call Lifecycle States](<#tool-call-lifecycle-states>)
  * [ToolCallEventStream and ThreadEventStream](<#toolcalleventstream-and-threadeventstream>)
  * [Tool Authorization System](<#tool-authorization-system>)
  * [Authorization Logic](<#authorization-logic>)
  * [Tool Results and Display](<#tool-results-and-display>)
  * [Content Block Rendering](<#content-block-rendering>)
  * [Diff Display](<#diff-display>)
  * [Terminal Output Display](<#terminal-output-display>)
  * [Custom Tools via Context Servers](<#custom-tools-via-context-servers>)
  * [Diagram: Context Server Tool Integration](<#diagram-context-server-tool-integration>)
  * [Context Server Integration](<#context-server-integration>)
  * [Tool Call Replay and Persistence](<#tool-call-replay-and-persistence>)
  * [Diagram: Tool Replay Sequence](<#diagram-tool-replay-sequence>)
  * [Tool Telemetry and Metrics](<#tool-telemetry-and-metrics>)
  * [Tool Limits and Error Handling](<#tool-limits-and-error-handling>)
  * [Tool Use Limits](<#tool-use-limits>)
  * [File Read Tracking](<#file-read-tracking>)
  * [Retry Logic](<#retry-logic>)
  * [Summary](<#summary>)
